# è‡ªç„¶è¯­è¨€æœç´¢åŠŸèƒ½ - æ¨¡å—åŒ–è®¾è®¡æ–‡æ¡£

**ç‰ˆæœ¬**: v1.0.0-beta
**çŠ¶æ€**: ğŸš§ å¼€å‘ä¸­ï¼ˆåŠŸèƒ½éš”ç¦»ï¼Œæœªå¼€æ”¾ï¼‰
**è®¾è®¡æ—¥æœŸ**: 2025-11-10
**è®¾è®¡åŸåˆ™**: å®Œå…¨æ¨¡å—åŒ–ã€åŠŸèƒ½éš”ç¦»ã€å¯æ’æ‹”è®¾è®¡

---

## ğŸ“‹ ç›®å½•

1. [éœ€æ±‚åˆ†æ](#éœ€æ±‚åˆ†æ)
2. [æ¶æ„è®¾è®¡](#æ¶æ„è®¾è®¡)
3. [æ¨¡å—åŒ–ç­–ç•¥](#æ¨¡å—åŒ–ç­–ç•¥)
4. [æ•°æ®åº“è®¾è®¡](#æ•°æ®åº“è®¾è®¡)
5. [API è®¾è®¡](#api-è®¾è®¡)
6. [åŠŸèƒ½å¼€å…³è®¾è®¡](#åŠŸèƒ½å¼€å…³è®¾è®¡)
7. [å®ç°è®¡åˆ’](#å®ç°è®¡åˆ’)
8. [æµ‹è¯•ç­–ç•¥](#æµ‹è¯•ç­–ç•¥)
9. [é£é™©æ§åˆ¶](#é£é™©æ§åˆ¶)

---

## éœ€æ±‚åˆ†æ

### åŠŸèƒ½æ¦‚è¿°

å®ç°åŸºäºè‡ªç„¶è¯­è¨€çš„æ™ºèƒ½æœç´¢ç³»ç»Ÿï¼Œå…è®¸ç”¨æˆ·ä½¿ç”¨è‡ªç„¶è¯­è¨€è¾“å…¥æŸ¥è¯¢ï¼Œç³»ç»Ÿè‡ªåŠ¨ï¼š
1. ä½¿ç”¨ LLM åˆ†è§£å’Œç²¾ç‚¼è‡ªç„¶è¯­è¨€æŸ¥è¯¢
2. ä½¿ç”¨ GPT-5 æœç´¢ç²¾ç‚¼åçš„é—®é¢˜ï¼Œè¿”å› URL å’Œæ ‡é¢˜
3. ä½¿ç”¨ Firecrawl Scrape API çˆ¬å–è¯¦ç»†å†…å®¹
4. å­˜å‚¨ç»“æœå¹¶é€šè¿‡ AI æœåŠ¡å¤„ç†
5. è¿”å›å¤„ç†åçš„ç»“æ„åŒ–æ•°æ®ç»™å‰ç«¯

### æ ¸å¿ƒéœ€æ±‚

#### åŠŸèƒ½éœ€æ±‚
- è‡ªç„¶è¯­è¨€æŸ¥è¯¢è§£æå’Œç²¾ç‚¼
- GPT-5 æœç´¢é›†æˆ
- Firecrawl Scrape é›†æˆ
- å•æ¬¡çˆ¬å–ï¼ˆä¸åŠ å…¥å®šæ—¶ä»»åŠ¡ï¼‰
- ç”¨æˆ·é€‰æ‹©å’Œåé¦ˆè®°å½•
- æ•°æ®å¿«ç…§ä¿å­˜

#### éåŠŸèƒ½éœ€æ±‚
- **æ¨¡å—åŒ–**ï¼šä¸ç°æœ‰åŠŸèƒ½å®Œå…¨éš”ç¦»
- **å¯æ’æ‹”**ï¼šå¯ä»¥éšæ—¶å¯ç”¨/ç¦ç”¨
- **å‘åå…¼å®¹**ï¼šä¸å½±å“ç°æœ‰åŠŸèƒ½
- **å¯æµ‹è¯•**ï¼šç‹¬ç«‹çš„æµ‹è¯•å¥—ä»¶
- **å¯æ‰©å±•**ï¼šæ”¯æŒåç»­åŠŸèƒ½è¿­ä»£

### å…³é”®çº¦æŸ

âš ï¸ **é‡è¦çº¦æŸ**ï¼š
1. **åŠŸèƒ½éš”ç¦»**ï¼šæ­¤åŠŸèƒ½ä¸ºåˆç‰ˆï¼ŒåæœŸå˜åŒ–å¤§ï¼Œå¿…é¡»ä¸ç°æœ‰åŠŸèƒ½å®Œå…¨éš”ç¦»
2. **åŠŸèƒ½å¼€å…³**ï¼šå¿…é¡»é€šè¿‡é…ç½®å¼€å…³æ§åˆ¶ï¼Œé»˜è®¤å…³é—­
3. **ç‹¬ç«‹æ¨¡å—**ï¼šä»£ç ç»„ç»‡åœ¨ç‹¬ç«‹ç›®å½•ï¼Œé¿å…ä¸ç°æœ‰ä»£ç è€¦åˆ
4. **æ•°æ®éš”ç¦»**ï¼šä½¿ç”¨ç‹¬ç«‹çš„æ•°æ®è¡¨ï¼Œé¿å…å½±å“ç°æœ‰æ•°æ®
5. **API éš”ç¦»**ï¼šä½¿ç”¨ç‹¬ç«‹çš„ API ç«¯ç‚¹ï¼Œé¿å…å½±å“ç°æœ‰ API

---

## æ¶æ„è®¾è®¡

### æ•´ä½“æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    å‰ç«¯åº”ç”¨ (Frontend)                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â”‚ HTTP/JSON
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              API Layer (ç‹¬ç«‹æ¨¡å—)                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  src/api/v1/endpoints/nl_search.py (æ–°å»º)                â”‚  â”‚
â”‚  â”‚  - POST /nl-search/queries                               â”‚  â”‚
â”‚  â”‚  - GET  /nl-search/queries/{id}                          â”‚  â”‚
â”‚  â”‚  - POST /nl-search/selections                            â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â”‚ åŠŸèƒ½å¼€å…³æ£€æŸ¥
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Service Layer (ç‹¬ç«‹æ¨¡å—)                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  src/services/nl_search/ (æ–°å»ºç›®å½•)                       â”‚  â”‚
â”‚  â”‚  â”œâ”€â”€ nl_search_service.py       # æ ¸å¿ƒä¸šåŠ¡é€»è¾‘           â”‚  â”‚
â”‚  â”‚  â”œâ”€â”€ llm_processor.py            # LLM å¤„ç†æœåŠ¡           â”‚  â”‚
â”‚  â”‚  â”œâ”€â”€ gpt5_search_adapter.py      # GPT-5 æœç´¢é€‚é…å™¨      â”‚  â”‚
â”‚  â”‚  â””â”€â”€ content_enricher.py         # å†…å®¹å¢å¼ºæœåŠ¡           â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â”‚ ä¾èµ–æ³¨å…¥
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           Domain Layer (ç‹¬ç«‹å®ä½“)                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  src/core/domain/entities/nl_search/ (æ–°å»ºç›®å½•)          â”‚  â”‚
â”‚  â”‚  â”œâ”€â”€ nl_search_log.py            # æœç´¢è®°å½•å®ä½“           â”‚  â”‚
â”‚  â”‚  â”œâ”€â”€ nl_user_selection.py        # ç”¨æˆ·é€‰æ‹©å®ä½“           â”‚  â”‚
â”‚  â”‚  â””â”€â”€ enums.py                    # æšä¸¾å®šä¹‰               â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â”‚ ORM æ˜ å°„
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        Repository Layer (ç‹¬ç«‹ä»“åº“)                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  src/infrastructure/database/nl_search_repositories.py   â”‚  â”‚
â”‚  â”‚  â”œâ”€â”€ NLSearchLogRepository                               â”‚  â”‚
â”‚  â”‚  â””â”€â”€ NLUserSelectionRepository                           â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â”‚ MySQL æ•°æ®åº“æ“ä½œ
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    æ•°æ®åº“å±‚ (MySQL)                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Tables (æ•°æ®è¡¨)                                          â”‚  â”‚
â”‚  â”‚  â”œâ”€â”€ nl_search_logs           # è‡ªç„¶è¯­è¨€æœç´¢è®°å½•ï¼ˆæ–°å»ºï¼‰  â”‚  â”‚
â”‚  â”‚  â”œâ”€â”€ search_results           # å¤ç”¨ç°æœ‰è¡¨ï¼ˆå¯é€‰æ‰©å±•ï¼‰    â”‚  â”‚
â”‚  â”‚  â””â”€â”€ news_results             # å¤ç”¨ç°æœ‰è¡¨ï¼ˆAIå¤„ç†ç»“æœï¼‰  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### å¤–éƒ¨ä¾èµ–

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    å¤–éƒ¨æœåŠ¡é›†æˆ                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  LLM æœåŠ¡ (Query Parsing)                                â”‚  â”‚
â”‚  â”‚  - åˆ†è§£è‡ªç„¶è¯­è¨€æŸ¥è¯¢                                       â”‚  â”‚
â”‚  â”‚  - æå–å…³é”®æ¦‚å¿µå’Œæ„å›¾                                     â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  LLM æœåŠ¡ (Query Refinement)                             â”‚  â”‚
â”‚  â”‚  - ç²¾ç‚¼æœç´¢æŸ¥è¯¢                                           â”‚  â”‚
â”‚  â”‚  - ä¼˜åŒ–æœç´¢å…³é”®è¯                                         â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  GPT-5 æœç´¢æœåŠ¡                                           â”‚  â”‚
â”‚  â”‚  - æ‰§è¡Œæœç´¢æŸ¥è¯¢                                           â”‚  â”‚
â”‚  â”‚  - è¿”å› URL å’Œæ ‡é¢˜åˆ—è¡¨                                    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Firecrawl Scrape API (å¤ç”¨ç°æœ‰)                         â”‚  â”‚
â”‚  â”‚  - å•æ¬¡çˆ¬å–æ¨¡å¼                                           â”‚  â”‚
â”‚  â”‚  - ä¸åŠ å…¥å®šæ—¶ä»»åŠ¡                                         â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  AI å†…å®¹å¤„ç†æœåŠ¡ (ç°æœ‰)                                   â”‚  â”‚
â”‚  â”‚  - ç»“æœå­˜å‚¨åœ¨ news_results                               â”‚  â”‚
â”‚  â”‚  - é€šè¿‡ nl_search_log_id å…³è”                            â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## æ¨¡å—åŒ–ç­–ç•¥

### 1. ç›®å½•ç»“æ„è®¾è®¡

**æ–°å»ºç‹¬ç«‹ç›®å½•**ï¼Œé¿å…ä¸ç°æœ‰ä»£ç æ··åˆï¼š

```
src/
â”œâ”€â”€ api/v1/endpoints/
â”‚   â”œâ”€â”€ nl_search.py                          # æ–°å»ºï¼šè‡ªç„¶è¯­è¨€æœç´¢ API
â”‚   â””â”€â”€ ... (ç°æœ‰ç«¯ç‚¹ä¸å˜)
â”‚
â”œâ”€â”€ services/
â”‚   â”œâ”€â”€ nl_search/                            # æ–°å»ºï¼šç‹¬ç«‹ç›®å½•
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ nl_search_service.py              # æ ¸å¿ƒä¸šåŠ¡é€»è¾‘
â”‚   â”‚   â”œâ”€â”€ llm_processor.py                  # LLM å¤„ç†æœåŠ¡
â”‚   â”‚   â”œâ”€â”€ gpt5_search_adapter.py            # GPT-5 æœç´¢é€‚é…å™¨
â”‚   â”‚   â”œâ”€â”€ content_enricher.py               # å†…å®¹å¢å¼ºæœåŠ¡
â”‚   â”‚   â””â”€â”€ config.py                         # æ¨¡å—é…ç½®
â”‚   â””â”€â”€ ... (ç°æœ‰æœåŠ¡ä¸å˜)
â”‚
â”œâ”€â”€ core/domain/entities/
â”‚   â”œâ”€â”€ nl_search/                            # æ–°å»ºï¼šç‹¬ç«‹å®ä½“ç›®å½•
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ nl_search_log.py                  # æœç´¢è®°å½•å®ä½“
â”‚   â”‚   â”œâ”€â”€ nl_user_selection.py              # ç”¨æˆ·é€‰æ‹©å®ä½“
â”‚   â”‚   â””â”€â”€ enums.py                          # æšä¸¾å®šä¹‰
â”‚   â””â”€â”€ ... (ç°æœ‰å®ä½“ä¸å˜)
â”‚
â”œâ”€â”€ infrastructure/database/
â”‚   â”œâ”€â”€ nl_search_repositories.py             # æ–°å»ºï¼šç‹¬ç«‹ä»“åº“
â”‚   â””â”€â”€ ... (ç°æœ‰ä»“åº“ä¸å˜)
â”‚
â””â”€â”€ tests/
    â”œâ”€â”€ nl_search/                            # æ–°å»ºï¼šç‹¬ç«‹æµ‹è¯•ç›®å½•
    â”‚   â”œâ”€â”€ test_nl_search_service.py
    â”‚   â”œâ”€â”€ test_llm_processor.py
    â”‚   â”œâ”€â”€ test_gpt5_adapter.py
    â”‚   â””â”€â”€ test_api_endpoints.py
    â””â”€â”€ ... (ç°æœ‰æµ‹è¯•ä¸å˜)
```

### 2. å¯¼å…¥éš”ç¦»ç­–ç•¥

**è§„åˆ™**ï¼š
1. âœ… NL Search æ¨¡å—**å¯ä»¥**å¯¼å…¥ç°æœ‰æ¨¡å—ï¼ˆå•å‘ä¾èµ–ï¼‰
2. âŒ ç°æœ‰æ¨¡å—**ä¸èƒ½**å¯¼å…¥ NL Search æ¨¡å—ï¼ˆé¿å…å¾ªç¯ä¾èµ–ï¼‰
3. âœ… é€šè¿‡ä¾èµ–æ³¨å…¥å’Œæ¥å£è§£è€¦

**ç¤ºä¾‹**ï¼š

```python
# âœ… æ­£ç¡®ï¼šNL Search ä½¿ç”¨ç°æœ‰æœåŠ¡
from src.infrastructure.crawlers.firecrawl_adapter import FirecrawlAdapter

class NLSearchService:
    def __init__(self):
        self.firecrawl = FirecrawlAdapter()  # å¤ç”¨ç°æœ‰é€‚é…å™¨
```

```python
# âŒ é”™è¯¯ï¼šç°æœ‰æœåŠ¡ä¸åº”å¯¼å…¥ NL Search
# åœ¨ src/services/smart_search_service.py ä¸­
from src.services.nl_search.nl_search_service import NLSearchService  # ç¦æ­¢ï¼
```

### 3. æ•°æ®åº“éš”ç¦»ç­–ç•¥

**æ–°å»ºè¡¨**ï¼ˆå®Œå…¨ç‹¬ç«‹ï¼‰ï¼š
- `nl_search_logs` - è‡ªç„¶è¯­è¨€æœç´¢è®°å½•ï¼ˆç®€åŒ–ç‰ˆï¼‰

**æ‰©å±•ç°æœ‰è¡¨**ï¼ˆå¯é€‰ï¼Œéä¾µå…¥å¼ï¼‰ï¼š
- `search_results` - å¯é€‰æ·»åŠ å­—æ®µ `nl_search_log_id`
  - ä½¿ç”¨ `NULL` é»˜è®¤å€¼ï¼Œä¸å½±å“ç°æœ‰æ•°æ®
  - ç°æœ‰æŸ¥è¯¢ä¸å—å½±å“

**æ•°æ®éš”ç¦»è§„åˆ™**ï¼š
```sql
-- æŸ¥è¯¢ç°æœ‰æ•°æ®ï¼ˆæ’é™¤ NL Search æ•°æ®ï¼‰
SELECT * FROM search_results
WHERE nl_search_log_id IS NULL
ORDER BY created_at DESC;

-- æŸ¥è¯¢ NL Search æ•°æ®
SELECT * FROM search_results
WHERE nl_search_log_id IS NOT NULL
ORDER BY created_at DESC;

-- è·å–æŒ‡å®š NL æœç´¢çš„ç»“æœ
SELECT * FROM search_results
WHERE nl_search_log_id = 123456
ORDER BY created_at DESC;
```

**æ•°æ®æ¸…ç†ç­–ç•¥**ï¼š
```sql
-- å®šæœŸæ¸…ç†æ—§çš„ NL æœç´¢è®°å½•ï¼ˆä¿ç•™30å¤©ï¼‰
DELETE FROM nl_search_logs
WHERE created_at < DATE_SUB(NOW(), INTERVAL 30 DAY);

-- æ¸…ç†å…³è”çš„æœç´¢ç»“æœï¼ˆå¦‚æœä½¿ç”¨å…³è”å­—æ®µï¼‰
DELETE FROM search_results
WHERE nl_search_log_id IN (
  SELECT id FROM nl_search_logs
  WHERE created_at < DATE_SUB(NOW(), INTERVAL 30 DAY)
);
```

### 4. API éš”ç¦»ç­–ç•¥

**ç‹¬ç«‹è·¯ç”±å‰ç¼€**ï¼š

```python
# src/api/v1/endpoints/nl_search.py
from fastapi import APIRouter, Depends

router = APIRouter(
    prefix="/nl-search",        # ç‹¬ç«‹å‰ç¼€
    tags=["NL Search"],         # ç‹¬ç«‹æ ‡ç­¾
    dependencies=[Depends(check_nl_search_enabled)]  # åŠŸèƒ½å¼€å…³
)

@router.post("/queries")
async def create_nl_search_query(...):
    """åˆ›å»ºè‡ªç„¶è¯­è¨€æœç´¢"""
    pass

@router.get("/queries/{log_id}")
async def get_nl_search_results(...):
    """è·å–æœç´¢ç»“æœ"""
    pass
```

**ç°æœ‰ API ä¸å˜**ï¼š
- æ‰€æœ‰ç°æœ‰ç«¯ç‚¹ä¿æŒä¸å˜
- ä¸ä¿®æ”¹ç°æœ‰è·¯ç”±
- ä¸å½±å“ç°æœ‰å®¢æˆ·ç«¯

---

## æ•°æ®åº“è®¾è®¡

### 1. `nl_search_logs` - è‡ªç„¶è¯­è¨€æœç´¢è®°å½•ï¼ˆç®€åŒ–ç‰ˆï¼‰

**è¡¨ç»“æ„**ï¼ˆMySQLï¼‰ï¼š

```sql
CREATE TABLE nl_search_logs (
  id BIGINT AUTO_INCREMENT PRIMARY KEY COMMENT 'ä¸»é”®',
  query_text TEXT NOT NULL COMMENT 'åŸå§‹ç”¨æˆ·è¾“å…¥',
  llm_analysis JSON NULL COMMENT 'å¤§æ¨¡å‹è§£æç»“æ„ï¼ˆå…³é”®è¯ã€å®ä½“ã€æ—¶é—´èŒƒå›´ç­‰ï¼‰',
  created_at DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',

  INDEX idx_created (created_at DESC)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='è‡ªç„¶è¯­è¨€æœç´¢è®°å½•è¡¨ï¼ˆç®€åŒ–ç‰ˆï¼‰';
```

**å­—æ®µè¯´æ˜**ï¼š

| å­—æ®µ | ç±»å‹ | è¯´æ˜ | ç¤ºä¾‹ |
|------|------|------|------|
| `id` | BIGINT | ä¸»é”®ï¼Œè‡ªå¢ | 123456 |
| `query_text` | TEXT | åŸå§‹ç”¨æˆ·è¾“å…¥ | "æœ€è¿‘æœ‰å“ªäº›AIæŠ€æœ¯çªç ´" |
| `llm_analysis` | JSON | å¤§æ¨¡å‹è§£æç»“æœ | è§ä¸‹æ–¹ç¤ºä¾‹ |
| `created_at` | DATETIME | åˆ›å»ºæ—¶é—´ | 2024-11-10 10:00:00 |

**llm_analysis JSON ç»“æ„ç¤ºä¾‹**ï¼š

```json
{
  "intent": "technology_news",
  "keywords": ["AI", "æŠ€æœ¯çªç ´", "2024"],
  "entities": [
    {"type": "technology", "value": "AI"},
    {"type": "time", "value": "2024"}
  ],
  "time_range": {
    "type": "recent",
    "from": "2024-01-01",
    "to": "2024-12-31"
  },
  "category": "tech",
  "confidence": 0.95
}
```

**ç´¢å¼•è®¾è®¡**ï¼š

```sql
-- åˆ›å»ºæ—¶é—´ç´¢å¼•ï¼ˆç”¨äºæ—¶é—´æ’åºå’Œæ¸…ç†ï¼‰
CREATE INDEX idx_created ON nl_search_logs(created_at DESC);

-- å¯é€‰ï¼šJSONå­—æ®µç´¢å¼•ï¼ˆMySQL 5.7+ï¼‰
-- æ ¹æ®å…³é”®è¯æŸ¥è¯¢
CREATE INDEX idx_keywords ON nl_search_logs(
  (CAST(llm_analysis->'$.keywords' AS CHAR(255) ARRAY))
);
```

**è®¾è®¡è¯´æ˜**ï¼š

âœ… **ç®€åŒ–è®¾è®¡ä¼˜åŠ¿**ï¼š
- æç®€å­—æ®µè®¾è®¡ï¼Œæ˜“äºç†è§£å’Œç»´æŠ¤
- JSON å­—æ®µçµæ´»å­˜å‚¨ LLM è§£æç»“æœ
- é€‚åˆåˆç‰ˆåŠŸèƒ½å¿«é€Ÿè¿­ä»£

âš ï¸ **å¯é€‰æ‰©å±•å­—æ®µ**ï¼ˆæ ¹æ®éœ€è¦æ·»åŠ ï¼‰ï¼š
```sql
-- å¦‚éœ€ç”¨æˆ·è¿½è¸ª
user_id VARCHAR(64) NULL COMMENT 'ç”¨æˆ·ID',
INDEX idx_user_created (user_id, created_at DESC);

-- å¦‚éœ€çŠ¶æ€ç®¡ç†
status ENUM('pending', 'processing', 'completed', 'failed') DEFAULT 'pending',
INDEX idx_status (status, created_at DESC);
```

### 2. å…³è”æŸ¥è¯¢ç»“æœï¼ˆå¤ç”¨ç°æœ‰è¡¨ï¼‰

**è¯´æ˜**ï¼šç®€åŒ–ç‰ˆè®¾è®¡ä¸­ï¼Œæœç´¢ç»“æœå­˜å‚¨åœ¨ç°æœ‰çš„ `search_results` æˆ– `news_results` è¡¨ä¸­ï¼Œé€šè¿‡å…³è”å­—æ®µå®ç°å…³ç³»ã€‚

**å…³è”æ–¹å¼**ï¼š

```sql
-- æ–¹æ¡ˆ1ï¼šåœ¨ç°æœ‰è¡¨ä¸­æ·»åŠ å¯é€‰å­—æ®µ
ALTER TABLE search_results
ADD COLUMN nl_search_log_id BIGINT NULL COMMENT 'å…³è”çš„NLæœç´¢è®°å½•ID',
ADD INDEX idx_nl_search_log (nl_search_log_id);

-- æ–¹æ¡ˆ2ï¼šé€šè¿‡ä¸­é—´è¡¨å…³è”
CREATE TABLE nl_search_result_relations (
  id BIGINT AUTO_INCREMENT PRIMARY KEY,
  nl_search_log_id BIGINT NOT NULL COMMENT 'NLæœç´¢è®°å½•ID',
  result_id BIGINT NOT NULL COMMENT 'æœç´¢ç»“æœID',
  result_type ENUM('search_result', 'news_result') DEFAULT 'search_result',
  created_at DATETIME DEFAULT CURRENT_TIMESTAMP,

  INDEX idx_log (nl_search_log_id),
  INDEX idx_result (result_id, result_type),
  UNIQUE KEY uk_log_result (nl_search_log_id, result_id, result_type)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;
```

**æŸ¥è¯¢ç¤ºä¾‹**ï¼š

```sql
-- è·å–NLæœç´¢çš„æ‰€æœ‰ç»“æœ
SELECT sr.*
FROM search_results sr
WHERE sr.nl_search_log_id = 123456
ORDER BY sr.created_at DESC;

-- é€šè¿‡ä¸­é—´è¡¨æŸ¥è¯¢
SELECT sr.*, nsr.nl_search_log_id
FROM nl_search_result_relations nsr
JOIN search_results sr ON nsr.result_id = sr.id
WHERE nsr.nl_search_log_id = 123456;
```

---

## API è®¾è®¡

### API ç«¯ç‚¹è§„èŒƒ

**åŸºç¡€è·¯å¾„**: `/api/v1/nl-search`

### 1. åˆ›å»ºè‡ªç„¶è¯­è¨€æœç´¢

**æ¥å£**: `POST /api/v1/nl-search/queries`

**è¯·æ±‚**:
```json
{
  "query_text": "æœ€è¿‘æœ‰å“ªäº›AIæŠ€æœ¯çªç ´",
  "user_id": "123456",
  "options": {
    "max_results": 10,          // å¯é€‰ï¼šæœ€å¤§ç»“æœæ•°é‡
    "include_snapshot": true    // å¯é€‰ï¼šæ˜¯å¦ç«‹å³çˆ¬å–å†…å®¹
  }
}
```

**å“åº”**:
```json
{
  "code": 200,
  "message": "æŸ¥è¯¢åˆ›å»ºæˆåŠŸ",
  "data": {
    "search_log_id": "67890abcdef",
    "query_text": "æœ€è¿‘æœ‰å“ªäº›AIæŠ€æœ¯çªç ´",
    "refined_query": "AI æŠ€æœ¯çªç ´ 2024",
    "status": "processing",
    "estimated_completion_time": 5000  // æ¯«ç§’
  }
}
```

### 2. è·å–æœç´¢ç»“æœ

**æ¥å£**: `GET /api/v1/nl-search/queries/{log_id}`

**æŸ¥è¯¢å‚æ•°**:
- `include_details`: boolean - æ˜¯å¦åŒ…å«è¯¦ç»†å†…å®¹
- `page`: int - é¡µç 
- `page_size`: int - æ¯é¡µæ•°é‡

**å“åº”**:
```json
{
  "code": 200,
  "message": "è·å–æˆåŠŸ",
  "data": {
    "search_log": {
      "id": "67890abcdef",
      "query_text": "æœ€è¿‘æœ‰å“ªäº›AIæŠ€æœ¯çªç ´",
      "refined_query": "AI æŠ€æœ¯çªç ´ 2024",
      "status": "completed",
      "result_count": 15,
      "created_at": "2024-11-10T10:00:00Z"
    },
    "results": [
      {
        "id": "result_001",
        "title": "2024 AIæŠ€æœ¯çªç ´ç›˜ç‚¹",
        "summary": "...",
        "url": "https://example.com/ai-news",
        "score": 0.95,
        "created_at": "2024-11-10T10:02:00Z"
      }
    ],
    "pagination": {
      "page": 1,
      "page_size": 10,
      "total": 15,
      "total_pages": 2
    }
  }
}
```

### 3. è®°å½•ç”¨æˆ·é€‰æ‹©

**æ¥å£**: `POST /api/v1/nl-search/selections`

**è¯·æ±‚**:
```json
{
  "user_id": "123456",
  "search_log_id": "67890abcdef",
  "result_id": "result_001",
  "action_type": "click",
  "feedback": null  // å¯é€‰
}
```

**å“åº”**:
```json
{
  "code": 200,
  "message": "è®°å½•æˆåŠŸ",
  "data": {
    "selection_id": "sel_001"
  }
}
```

### 4. è·å–ç”¨æˆ·æœç´¢å†å²

**æ¥å£**: `GET /api/v1/nl-search/users/{user_id}/history`

**æŸ¥è¯¢å‚æ•°**:
- `limit`: int - è¿”å›æ•°é‡ï¼ˆé»˜è®¤ 10ï¼‰
- `offset`: int - åç§»é‡ï¼ˆé»˜è®¤ 0ï¼‰

**å“åº”**:
```json
{
  "code": 200,
  "message": "è·å–æˆåŠŸ",
  "data": {
    "history": [
      {
        "search_log_id": "67890abcdef",
        "query_text": "æœ€è¿‘æœ‰å“ªäº›AIæŠ€æœ¯çªç ´",
        "result_count": 15,
        "created_at": "2024-11-10T10:00:00Z"
      }
    ],
    "total": 50
  }
}
```

---

## åŠŸèƒ½å¼€å…³è®¾è®¡

### 1. é…ç½®æ–‡ä»¶æ–¹å¼

**æ–‡ä»¶**: `src/services/nl_search/config.py`

```python
"""
è‡ªç„¶è¯­è¨€æœç´¢åŠŸèƒ½é…ç½®
"""
from pydantic import BaseSettings
from typing import Optional

class NLSearchConfig(BaseSettings):
    """NL Search åŠŸèƒ½é…ç½®"""

    # åŠŸèƒ½å¼€å…³
    enabled: bool = False  # é»˜è®¤å…³é—­ï¼

    # LLM é…ç½®
    llm_api_key: Optional[str] = None
    llm_model: str = "gpt-4"
    llm_temperature: float = 0.7

    # GPT-5 æœç´¢é…ç½®
    gpt5_search_api_key: Optional[str] = None
    gpt5_max_results: int = 10

    # Scrape é…ç½®
    scrape_timeout: int = 30
    scrape_max_concurrent: int = 3

    # ä¸šåŠ¡é…ç½®
    max_results_per_query: int = 20
    enable_auto_scrape: bool = True  # æ˜¯å¦è‡ªåŠ¨çˆ¬å–å†…å®¹

    class Config:
        env_prefix = "NL_SEARCH_"
        env_file = ".env"

# å…¨å±€é…ç½®å®ä¾‹
nl_search_config = NLSearchConfig()
```

**ç¯å¢ƒå˜é‡**ï¼ˆ`.env` æ–‡ä»¶ï¼‰ï¼š

```bash
# NL Search åŠŸèƒ½å¼€å…³
NL_SEARCH_ENABLED=false              # é»˜è®¤å…³é—­

# LLM é…ç½®
NL_SEARCH_LLM_API_KEY=sk-...
NL_SEARCH_LLM_MODEL=gpt-4

# GPT-5 æœç´¢é…ç½®
NL_SEARCH_GPT5_SEARCH_API_KEY=...
NL_SEARCH_GPT5_MAX_RESULTS=10

# ä¸šåŠ¡é…ç½®
NL_SEARCH_MAX_RESULTS_PER_QUERY=20
NL_SEARCH_ENABLE_AUTO_SCRAPE=true
```

### 2. API å±‚åŠŸèƒ½æ£€æŸ¥

**ä¾èµ–å‡½æ•°**ï¼š

```python
# src/api/v1/endpoints/nl_search.py
from fastapi import HTTPException, status
from src.services.nl_search.config import nl_search_config

async def check_nl_search_enabled():
    """æ£€æŸ¥ NL Search åŠŸèƒ½æ˜¯å¦å¯ç”¨"""
    if not nl_search_config.enabled:
        raise HTTPException(
            status_code=status.HTTP_403_FORBIDDEN,
            detail="è‡ªç„¶è¯­è¨€æœç´¢åŠŸèƒ½å½“å‰æœªå¯ç”¨"
        )
    return True

# åº”ç”¨åˆ°æ‰€æœ‰ç«¯ç‚¹
router = APIRouter(
    prefix="/nl-search",
    tags=["NL Search"],
    dependencies=[Depends(check_nl_search_enabled)]  # å…¨å±€åŠŸèƒ½æ£€æŸ¥
)
```

### 3. å‰ç«¯åŠŸèƒ½æ£€æŸ¥æ¥å£

**æ¥å£**: `GET /api/v1/nl-search/status`

```python
@router.get("/status")
async def get_nl_search_status():
    """è·å– NL Search åŠŸèƒ½çŠ¶æ€"""
    return {
        "enabled": nl_search_config.enabled,
        "version": "1.0.0-beta"
    }
```

**å‰ç«¯è°ƒç”¨**ï¼š
```javascript
// æ£€æŸ¥åŠŸèƒ½æ˜¯å¦å¯ç”¨
const checkNLSearchAvailability = async () => {
  const response = await fetch('/api/v1/nl-search/status');
  const { enabled } = await response.json();

  if (!enabled) {
    // éšè— NL Search ç›¸å…³UI
    document.getElementById('nl-search-button').style.display = 'none';
  }
};
```

---

## å®ç°è®¡åˆ’

### Phase 1: åŸºç¡€æ¶æ„æ­å»ºï¼ˆ1-2 å¤©ï¼‰

**ç›®æ ‡**: å»ºç«‹ç‹¬ç«‹çš„æ¨¡å—ç»“æ„å’ŒåŸºç¡€è®¾æ–½

**ä»»åŠ¡æ¸…å•**:
- [ ] åˆ›å»ºç›®å½•ç»“æ„
  - [ ] `src/services/nl_search/`
  - [ ] `src/core/domain/entities/nl_search/`
  - [ ] `src/infrastructure/database/nl_search_repositories.py`
  - [ ] `tests/nl_search/`

- [ ] å®šä¹‰å®ä½“æ¨¡å‹
  - [ ] `NLSearchLog` å®ä½“
  - [ ] `NLUserSelection` å®ä½“
  - [ ] æšä¸¾å®šä¹‰ (`ActionType`, `SearchStatus`)

- [ ] å®ç°ä»“åº“å±‚
  - [ ] `NLSearchLogRepository`
  - [ ] `NLUserSelectionRepository`
  - [ ] æ•°æ®åº“ç´¢å¼•åˆ›å»ºè„šæœ¬

- [ ] é…ç½®åŠŸèƒ½å¼€å…³
  - [ ] `NLSearchConfig` é…ç½®ç±»
  - [ ] ç¯å¢ƒå˜é‡é…ç½®
  - [ ] åŠŸèƒ½æ£€æŸ¥ä¾èµ–å‡½æ•°

**éªŒæ”¶æ ‡å‡†**:
- âœ… ç›®å½•ç»“æ„å®Œæ•´åˆ›å»º
- âœ… æ‰€æœ‰å®ä½“æ¨¡å‹é€šè¿‡ç±»å‹æ£€æŸ¥
- âœ… ä»“åº“å±‚å•å…ƒæµ‹è¯•é€šè¿‡
- âœ… åŠŸèƒ½å¼€å…³æ­£å¸¸å·¥ä½œ

### Phase 2: LLM å¤„ç†æœåŠ¡ï¼ˆ2-3 å¤©ï¼‰

**ç›®æ ‡**: å®ç°è‡ªç„¶è¯­è¨€æŸ¥è¯¢çš„è§£æå’Œç²¾ç‚¼

**ä»»åŠ¡æ¸…å•**:
- [ ] å®ç° LLM å¤„ç†å™¨
  - [ ] `LLMProcessor` ç±»
  - [ ] æŸ¥è¯¢è§£æåŠŸèƒ½
  - [ ] æŸ¥è¯¢ç²¾ç‚¼åŠŸèƒ½
  - [ ] é”™è¯¯å¤„ç†å’Œé‡è¯•æœºåˆ¶

- [ ] LLM API é›†æˆ
  - [ ] OpenAI API å®¢æˆ·ç«¯å°è£…
  - [ ] Prompt æ¨¡æ¿è®¾è®¡
  - [ ] å“åº”è§£æå’ŒéªŒè¯

- [ ] å•å…ƒæµ‹è¯•
  - [ ] Mock LLM API å“åº”
  - [ ] æµ‹è¯•å„ç§æŸ¥è¯¢åœºæ™¯
  - [ ] æµ‹è¯•é”™è¯¯å¤„ç†

**éªŒæ”¶æ ‡å‡†**:
- âœ… LLM å¤„ç†å™¨å•å…ƒæµ‹è¯•é€šè¿‡ï¼ˆè¦†ç›–ç‡ >80%ï¼‰
- âœ… æ”¯æŒå¤šç§æŸ¥è¯¢ç±»å‹ï¼ˆæ–°é—»ã€æŠ€æœ¯ã€äº§å“ç­‰ï¼‰
- âœ… é”™è¯¯å¤„ç†å®Œå–„ï¼Œä¸å½±å“ä¸»æµç¨‹

### Phase 3: GPT-5 æœç´¢é›†æˆï¼ˆ2-3 å¤©ï¼‰

**ç›®æ ‡**: å®ç° GPT-5 æœç´¢åŠŸèƒ½

**ä»»åŠ¡æ¸…å•**:
- [ ] å®ç° GPT-5 æœç´¢é€‚é…å™¨
  - [ ] `GPT5SearchAdapter` ç±»
  - [ ] æœç´¢è¯·æ±‚æ„å»º
  - [ ] ç»“æœè§£æå’Œæ ¼å¼åŒ–

- [ ] ç»“æœè¿‡æ»¤å’Œæ’åº
  - [ ] ç›¸å…³æ€§è¯„åˆ†
  - [ ] å»é‡é€»è¾‘
  - [ ] ç»“æœæ’åº

- [ ] é›†æˆæµ‹è¯•
  - [ ] ç«¯åˆ°ç«¯æœç´¢æµç¨‹æµ‹è¯•
  - [ ] æ€§èƒ½æµ‹è¯•
  - [ ] é”™è¯¯åœºæ™¯æµ‹è¯•

**éªŒæ”¶æ ‡å‡†**:
- âœ… GPT-5 æœç´¢æ­£å¸¸å·¥ä½œ
- âœ… è¿”å›ç»“æœå‡†ç¡®åº¦ >85%
- âœ… å¹³å‡å“åº”æ—¶é—´ <3ç§’

### Phase 4: å†…å®¹çˆ¬å–é›†æˆï¼ˆ2-3 å¤©ï¼‰

**ç›®æ ‡**: é›†æˆ Firecrawl Scrapeï¼Œå®ç°å•æ¬¡çˆ¬å–

**ä»»åŠ¡æ¸…å•**:
- [ ] æ‰©å±• Firecrawl é€‚é…å™¨
  - [ ] æ·»åŠ å•æ¬¡çˆ¬å–æ¨¡å¼
  - [ ] æ·»åŠ  NL Search æ¥æºæ ‡è¯†
  - [ ] ç»“æœå…³è” nl_search_log_id

- [ ] å†…å®¹å¢å¼ºæœåŠ¡
  - [ ] `ContentEnricher` ç±»
  - [ ] æ‰¹é‡çˆ¬å–åè°ƒ
  - [ ] è¿›åº¦è·Ÿè¸ª

- [ ] é”™è¯¯å¤„ç†
  - [ ] éƒ¨åˆ†å¤±è´¥å®¹é”™
  - [ ] çˆ¬å–é‡è¯•æœºåˆ¶
  - [ ] å¤±è´¥é€šçŸ¥

**éªŒæ”¶æ ‡å‡†**:
- âœ… å•æ¬¡çˆ¬å–æ¨¡å¼æ­£å¸¸å·¥ä½œ
- âœ… ä¸å½±å“ç°æœ‰å®šæ—¶çˆ¬å–åŠŸèƒ½
- âœ… çˆ¬å–æˆåŠŸç‡ >90%

### Phase 5: æ ¸å¿ƒä¸šåŠ¡æœåŠ¡ï¼ˆ3-4 å¤©ï¼‰

**ç›®æ ‡**: å®ç°å®Œæ•´çš„ä¸šåŠ¡æµç¨‹ç¼–æ’

**ä»»åŠ¡æ¸…å•**:
- [ ] å®ç°æ ¸å¿ƒæœåŠ¡
  - [ ] `NLSearchService` ç±»
  - [ ] å®Œæ•´æœç´¢æµç¨‹ç¼–æ’
  - [ ] å¼‚æ­¥ä»»åŠ¡å¤„ç†
  - [ ] çŠ¶æ€ç®¡ç†

- [ ] ç”¨æˆ·é€‰æ‹©è®°å½•
  - [ ] é€‰æ‹©è®°å½•åŠŸèƒ½
  - [ ] å¿«ç…§ä¿å­˜é€»è¾‘
  - [ ] ç»Ÿè®¡åˆ†æ

- [ ] é›†æˆæµ‹è¯•
  - [ ] å®Œæ•´æµç¨‹æµ‹è¯•
  - [ ] å¹¶å‘æµ‹è¯•
  - [ ] è¾¹ç•Œæ¡ä»¶æµ‹è¯•

**éªŒæ”¶æ ‡å‡†**:
- âœ… å®Œæ•´æœç´¢æµç¨‹æ­£å¸¸å·¥ä½œ
- âœ… ç”¨æˆ·é€‰æ‹©è®°å½•å‡†ç¡®
- âœ… æœåŠ¡ç¨³å®šæ€§ >99%

### Phase 6: API ç«¯ç‚¹å®ç°ï¼ˆ2-3 å¤©ï¼‰

**ç›®æ ‡**: å®ç°æ‰€æœ‰ API ç«¯ç‚¹

**ä»»åŠ¡æ¸…å•**:
- [ ] å®ç° API ç«¯ç‚¹
  - [ ] POST /queries
  - [ ] GET /queries/{log_id}
  - [ ] POST /selections
  - [ ] GET /users/{user_id}/history
  - [ ] GET /status

- [ ] API æ–‡æ¡£
  - [ ] OpenAPI/Swagger æ–‡æ¡£
  - [ ] è¯·æ±‚/å“åº”ç¤ºä¾‹
  - [ ] é”™è¯¯ç è¯´æ˜

- [ ] API æµ‹è¯•
  - [ ] é›†æˆæµ‹è¯•
  - [ ] è´Ÿè½½æµ‹è¯•
  - [ ] å®‰å…¨æµ‹è¯•

**éªŒæ”¶æ ‡å‡†**:
- âœ… æ‰€æœ‰ API ç«¯ç‚¹æ­£å¸¸å·¥ä½œ
- âœ… API æ–‡æ¡£å®Œæ•´å‡†ç¡®
- âœ… API å“åº”æ—¶é—´ <500msï¼ˆP95ï¼‰

### Phase 7: æµ‹è¯•å’Œä¼˜åŒ–ï¼ˆ2-3 å¤©ï¼‰

**ç›®æ ‡**: å…¨é¢æµ‹è¯•å’Œæ€§èƒ½ä¼˜åŒ–

**ä»»åŠ¡æ¸…å•**:
- [ ] å•å…ƒæµ‹è¯•å®Œå–„
  - [ ] æµ‹è¯•è¦†ç›–ç‡ >85%
  - [ ] è¾¹ç•Œæ¡ä»¶æµ‹è¯•
  - [ ] å¼‚å¸¸åœºæ™¯æµ‹è¯•

- [ ] é›†æˆæµ‹è¯•
  - [ ] ç«¯åˆ°ç«¯æµç¨‹æµ‹è¯•
  - [ ] ä¸ç°æœ‰åŠŸèƒ½éš”ç¦»æµ‹è¯•
  - [ ] æ•°æ®ä¸€è‡´æ€§æµ‹è¯•

- [ ] æ€§èƒ½ä¼˜åŒ–
  - [ ] æ•°æ®åº“æŸ¥è¯¢ä¼˜åŒ–
  - [ ] ç¼“å­˜ç­–ç•¥
  - [ ] å¹¶å‘æ§åˆ¶

**éªŒæ”¶æ ‡å‡†**:
- âœ… æµ‹è¯•è¦†ç›–ç‡ >85%
- âœ… æ‰€æœ‰æµ‹è¯•é€šè¿‡
- âœ… æ€§èƒ½æŒ‡æ ‡è¾¾æ ‡

### Phase 8: æ–‡æ¡£å’Œéƒ¨ç½²å‡†å¤‡ï¼ˆ1-2 å¤©ï¼‰

**ç›®æ ‡**: å®Œå–„æ–‡æ¡£ï¼Œå‡†å¤‡éƒ¨ç½²

**ä»»åŠ¡æ¸…å•**:
- [ ] æŠ€æœ¯æ–‡æ¡£
  - [ ] æ¶æ„æ–‡æ¡£
  - [ ] API æ–‡æ¡£
  - [ ] éƒ¨ç½²æ–‡æ¡£
  - [ ] è¿ç»´æ–‡æ¡£

- [ ] ç”¨æˆ·æ–‡æ¡£
  - [ ] åŠŸèƒ½è¯´æ˜
  - [ ] ä½¿ç”¨æŒ‡å—
  - [ ] FAQ

- [ ] éƒ¨ç½²å‡†å¤‡
  - [ ] é…ç½®æ–‡ä»¶æ¨¡æ¿
  - [ ] æ•°æ®åº“è¿ç§»è„šæœ¬
  - [ ] ç›‘æ§é…ç½®

**éªŒæ”¶æ ‡å‡†**:
- âœ… æ‰€æœ‰æ–‡æ¡£å®Œæ•´å‡†ç¡®
- âœ… éƒ¨ç½²è„šæœ¬éªŒè¯é€šè¿‡
- âœ… ç›‘æ§å‘Šè­¦é…ç½®å®Œæˆ

**æ€»é¢„è®¡æ—¶é—´**: 15-23 å¤©

---

## æµ‹è¯•ç­–ç•¥

### 1. å•å…ƒæµ‹è¯•

**è¦†ç›–èŒƒå›´**:
- æ‰€æœ‰æœåŠ¡ç±»
- æ‰€æœ‰ä»“åº“ç±»
- æ‰€æœ‰å·¥å…·å‡½æ•°

**æµ‹è¯•æ¡†æ¶**: pytest

**ç¤ºä¾‹**:
```python
# tests/nl_search/test_llm_processor.py
import pytest
from unittest.mock import Mock, patch
from src.services.nl_search.llm_processor import LLMProcessor

class TestLLMProcessor:
    @pytest.fixture
    def processor(self):
        return LLMProcessor()

    def test_parse_query_success(self, processor):
        """æµ‹è¯•æŸ¥è¯¢è§£ææˆåŠŸåœºæ™¯"""
        query = "æœ€è¿‘æœ‰å“ªäº›AIæŠ€æœ¯çªç ´"

        with patch('openai.ChatCompletion.create') as mock_llm:
            mock_llm.return_value = Mock(
                choices=[Mock(message=Mock(content='{"intent": "tech_news"}'))]
            )

            result = processor.parse_query(query)

            assert result['intent'] == 'tech_news'
            assert 'keywords' in result

    def test_parse_query_error_handling(self, processor):
        """æµ‹è¯•æŸ¥è¯¢è§£æé”™è¯¯å¤„ç†"""
        query = "æµ‹è¯•æŸ¥è¯¢"

        with patch('openai.ChatCompletion.create') as mock_llm:
            mock_llm.side_effect = Exception("API Error")

            result = processor.parse_query(query)

            assert result is None  # é”™è¯¯æ—¶è¿”å› None
```

### 2. é›†æˆæµ‹è¯•

**æµ‹è¯•åœºæ™¯**:
- å®Œæ•´æœç´¢æµç¨‹
- åŠŸèƒ½å¼€å…³æ§åˆ¶
- ä¸ç°æœ‰åŠŸèƒ½éš”ç¦»

**ç¤ºä¾‹**:
```python
# tests/nl_search/test_integration.py
import pytest
from httpx import AsyncClient
from src.main import app

@pytest.mark.asyncio
class TestNLSearchIntegration:
    async def test_complete_search_flow(self):
        """æµ‹è¯•å®Œæ•´æœç´¢æµç¨‹"""
        async with AsyncClient(app=app, base_url="http://test") as ac:
            # 1. åˆ›å»ºæœç´¢
            response = await ac.post(
                "/api/v1/nl-search/queries",
                json={"query_text": "AIæŠ€æœ¯", "user_id": "test_user"}
            )
            assert response.status_code == 200
            log_id = response.json()['data']['search_log_id']

            # 2. è·å–ç»“æœ
            response = await ac.get(f"/api/v1/nl-search/queries/{log_id}")
            assert response.status_code == 200
            assert len(response.json()['data']['results']) > 0

    async def test_feature_toggle_disabled(self):
        """æµ‹è¯•åŠŸèƒ½å¼€å…³å…³é—­æ—¶çš„è¡Œä¸º"""
        # è®¾ç½®åŠŸèƒ½å¼€å…³ä¸ºå…³é—­
        with patch('src.services.nl_search.config.nl_search_config.enabled', False):
            async with AsyncClient(app=app, base_url="http://test") as ac:
                response = await ac.post(
                    "/api/v1/nl-search/queries",
                    json={"query_text": "æµ‹è¯•"}
                )
                assert response.status_code == 403  # åŠŸèƒ½æœªå¯ç”¨
```

### 3. éš”ç¦»æµ‹è¯•

**ç›®æ ‡**: éªŒè¯ä¸å½±å“ç°æœ‰åŠŸèƒ½

```python
# tests/nl_search/test_isolation.py
class TestModuleIsolation:
    def test_no_existing_imports(self):
        """ç¡®ä¿ç°æœ‰æ¨¡å—ä¸å¯¼å…¥ NL Search"""
        import ast
        import glob

        # æ£€æŸ¥æ‰€æœ‰ç°æœ‰æœåŠ¡æ–‡ä»¶
        for file in glob.glob("src/services/*.py"):
            if "nl_search" in file:
                continue  # è·³è¿‡ NL Search è‡ªå·±çš„æ–‡ä»¶

            with open(file) as f:
                tree = ast.parse(f.read())

            # æ£€æŸ¥æ‰€æœ‰ import è¯­å¥
            for node in ast.walk(tree):
                if isinstance(node, (ast.Import, ast.ImportFrom)):
                    if hasattr(node, 'module') and node.module:
                        assert 'nl_search' not in node.module

    def test_existing_api_unchanged(self):
        """ç¡®ä¿ç°æœ‰ API ç«¯ç‚¹æœªå—å½±å“"""
        # è·å–æ‰€æœ‰ç°æœ‰è·¯ç”±
        from src.main import app
        existing_routes = [route.path for route in app.routes]

        # ç¡®ä¿æ²¡æœ‰ /nl-search å‰ç¼€çš„ç°æœ‰è·¯ç”±
        for route in existing_routes:
            if route.startswith("/api/v1/search"):  # ç°æœ‰æœç´¢è·¯ç”±
                assert "nl-search" not in route
```

### 4. æ€§èƒ½æµ‹è¯•

**æµ‹è¯•å·¥å…·**: locust

**æµ‹è¯•åœºæ™¯**:
```python
# tests/nl_search/test_performance.py
from locust import HttpUser, task, between

class NLSearchUser(HttpUser):
    wait_time = between(1, 3)

    @task
    def create_search(self):
        """æ¨¡æ‹Ÿåˆ›å»ºæœç´¢"""
        self.client.post(
            "/api/v1/nl-search/queries",
            json={"query_text": "AIæŠ€æœ¯", "user_id": "perf_test"}
        )

    @task(3)
    def get_results(self):
        """æ¨¡æ‹Ÿè·å–ç»“æœï¼ˆæ›´é«˜é¢‘ç‡ï¼‰"""
        self.client.get("/api/v1/nl-search/queries/test_log_id")
```

**æ€§èƒ½åŸºå‡†**:
- API å“åº”æ—¶é—´ï¼ˆP95ï¼‰< 500ms
- æœç´¢å¤„ç†æ—¶é—´ < 5ç§’
- å¹¶å‘æ”¯æŒ > 100 QPS

---

## é£é™©æ§åˆ¶

### 1. æŠ€æœ¯é£é™©

| é£é™© | å½±å“ | æ¦‚ç‡ | ç¼“è§£æªæ–½ |
|------|------|------|---------|
| LLM API ä¸ç¨³å®š | é«˜ | ä¸­ | å®ç°é‡è¯•æœºåˆ¶ã€é™çº§æ–¹æ¡ˆ |
| GPT-5 API é™æµ | ä¸­ | é«˜ | è¯·æ±‚é˜Ÿåˆ—ã€é€Ÿç‡é™åˆ¶ |
| Scrape å¤±è´¥ç‡é«˜ | ä¸­ | ä¸­ | éƒ¨åˆ†å¤±è´¥å®¹é”™ã€é‡è¯•æœºåˆ¶ |
| æ•°æ®åº“æ€§èƒ½é—®é¢˜ | é«˜ | ä½ | ç´¢å¼•ä¼˜åŒ–ã€æŸ¥è¯¢ä¼˜åŒ– |

### 2. ä¸šåŠ¡é£é™©

| é£é™© | å½±å“ | æ¦‚ç‡ | ç¼“è§£æªæ–½ |
|------|------|------|---------|
| ç»“æœè´¨é‡ä¸è¾¾æ ‡ | é«˜ | ä¸­ | äººå·¥reviewã€åé¦ˆæœºåˆ¶ |
| ç”¨æˆ·ä½“éªŒå·® | ä¸­ | ä¸­ | æ€§èƒ½ä¼˜åŒ–ã€UIä¼˜åŒ– |
| æˆæœ¬è¶…é¢„ç®— | é«˜ | ä¸­ | æˆæœ¬ç›‘æ§ã€é™é¢æ§åˆ¶ |

### 3. ä¾èµ–é£é™©

| ä¾èµ– | é£é™© | ç¼“è§£æªæ–½ |
|------|------|---------|
| OpenAI API | æœåŠ¡ä¸­æ–­ | ç¼“å­˜æœºåˆ¶ã€é™çº§æ–¹æ¡ˆ |
| GPT-5 API | å˜æ›´æˆ–åºŸå¼ƒ | æŠ½è±¡æ¥å£ã€é€‚é…å™¨æ¨¡å¼ |
| Firecrawl | é™æµæˆ–æ•…éšœ | è¯·æ±‚é˜Ÿåˆ—ã€é”™è¯¯å¤„ç† |

### 4. æ•°æ®é£é™©

| é£é™© | å½±å“ | ç¼“è§£æªæ–½ |
|------|------|---------|
| æ•°æ®ä¸¢å¤± | é«˜ | å®šæœŸå¤‡ä»½ã€æ•°æ®å¿«ç…§ |
| æ•°æ®æ³„éœ² | é«˜ | è®¿é—®æ§åˆ¶ã€åŠ å¯†å­˜å‚¨ |
| æ•°æ®ä¸€è‡´æ€§ | ä¸­ | äº‹åŠ¡æ§åˆ¶ã€ä¸€è‡´æ€§æ£€æŸ¥ |

### 5. å›æ»šæ–¹æ¡ˆ

**ç´§æ€¥å›æ»šæ­¥éª¤**:

1. **å…³é—­åŠŸèƒ½å¼€å…³**
   ```bash
   # ä¿®æ”¹ç¯å¢ƒå˜é‡
   NL_SEARCH_ENABLED=false

   # é‡å¯æœåŠ¡
   supervisorctl restart gunicorn
   ```

2. **æ•°æ®æ¸…ç†**ï¼ˆå¯é€‰ï¼‰
   ```sql
   -- åˆ é™¤ NL Search ç›¸å…³æ•°æ®
   DROP TABLE IF EXISTS nl_search_logs;

   -- æ¸…ç† search_results ä¸­çš„å…³è”ï¼ˆå¦‚æœæ·»åŠ äº†è¯¥å­—æ®µï¼‰
   UPDATE search_results
   SET nl_search_log_id = NULL
   WHERE nl_search_log_id IS NOT NULL;

   -- æˆ–è€…åˆ é™¤å…³è”å­—æ®µ
   ALTER TABLE search_results
   DROP COLUMN IF EXISTS nl_search_log_id;
   ```

3. **ä»£ç å›æ»š**ï¼ˆå¦‚éœ€ï¼‰
   ```bash
   git revert <commit-hash>
   git push origin main
   ```

---

## é™„å½•

### A. ç›¸å…³æ–‡æ¡£

- [æ–°åŠŸèƒ½éœ€æ±‚](../claudedocs/æ–°åŠŸèƒ½.md)
- [ER å…³ç³»è®¾è®¡](../claudedocs/nl_search_relations.md)
- [Firecrawl é›†æˆæ–‡æ¡£](FIRECRAWL_MAP_API_GUIDE.md)

### B. è”ç³»äºº

- **äº§å“è´Ÿè´£äºº**: é™†å·¥
- **æŠ€æœ¯è´Ÿè´£äºº**: TBD
- **åç«¯å¼€å‘**: TBD
- **å‰ç«¯å¼€å‘**: TBD

### C. æ›´æ–°è®°å½•

| æ—¥æœŸ | ç‰ˆæœ¬ | å˜æ›´å†…å®¹ | ä½œè€… |
|------|------|---------|------|
| 2025-11-10 | v1.0.0 | åˆå§‹ç‰ˆæœ¬ | Claude Code |

---

**æ–‡æ¡£çŠ¶æ€**: âœ… å·²å®Œæˆ
**ä¸‹ä¸€æ­¥**: ç­‰å¾…æŠ€æœ¯è¯„å®¡å’Œäº§å“ç¡®è®¤
