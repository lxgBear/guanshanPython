# å®å¡”MongoDBè¿æ¥é…ç½®æŒ‡å—

**æœåŠ¡å™¨ä¿¡æ¯**:
- å®å¡”é¢æ¿åœ°å€: https://hancens.top:18314/cbece14e
- å®å¡”ç”¨æˆ·å: mbjqhmkm
- å®å¡”å¯†ç : asjklquio1z
- æœåŠ¡å™¨åŸŸå: hancens.top

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0
**æœ€åæ›´æ–°**: 2025-10-16

---

## âš ï¸ é‡è¦è¯´æ˜

**å®å¡”é¢æ¿å¯†ç  â‰  MongoDBæ•°æ®åº“å¯†ç **

- å®å¡”é¢æ¿å‡­æ®ï¼ˆmbjqhmkm/asjklquio1zï¼‰ï¼šä»…ç”¨äºç™»å½•å®å¡”Webç®¡ç†ç•Œé¢
- MongoDBå‡­æ®ï¼šéœ€è¦åœ¨MongoDBä¸­å•ç‹¬åˆ›å»ºï¼Œç”¨äºåº”ç”¨ç¨‹åºè¿æ¥æ•°æ®åº“

---

## ğŸ“‹ é…ç½®æµç¨‹æ¦‚è§ˆ

```
æ­¥éª¤1: ç™»å½•å®å¡”é¢æ¿ (2åˆ†é’Ÿ)
   â†“
æ­¥éª¤2: æ£€æŸ¥MongoDBå®‰è£…å’Œè¿è¡ŒçŠ¶æ€ (1åˆ†é’Ÿ)
   â†“
æ­¥éª¤3: é…ç½®MongoDBè¿œç¨‹è®¿é—® (5åˆ†é’Ÿ)
   â†“
æ­¥éª¤4: åˆ›å»ºæ•°æ®åº“å’Œç”¨æˆ· (3åˆ†é’Ÿ)
   â†“
æ­¥éª¤5: é…ç½®é˜²ç«å¢™è§„åˆ™ (3åˆ†é’Ÿ)
   â†“
æ­¥éª¤6: æµ‹è¯•è¿æ¥ (2åˆ†é’Ÿ)
   â†“
æ­¥éª¤7: é…ç½®é¡¹ç›®ç¯å¢ƒå˜é‡ (2åˆ†é’Ÿ)

æ€»è®¡: çº¦20åˆ†é’Ÿ
```

---

## æ­¥éª¤1: ç™»å½•å®å¡”é¢æ¿

### 1.1 è®¿é—®å®å¡”é¢æ¿

åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€ï¼š
```
https://hancens.top:18314/cbece14e
```

**è¯´æ˜**:
- `18314`: å®å¡”é¢æ¿è®¿é—®ç«¯å£ï¼ˆéé»˜è®¤8888ï¼Œå·²è‡ªå®šä¹‰ï¼‰
- `/cbece14e`: å®‰å…¨å…¥å£è·¯å¾„ï¼ˆé˜²æ­¢æš´åŠ›ç ´è§£ï¼‰

### 1.2 è¾“å…¥ç™»å½•å‡­æ®

```
ç”¨æˆ·å: mbjqhmkm
å¯†ç : asjklquio1z
```

### 1.3 éªŒè¯ç™»å½•æˆåŠŸ

ç™»å½•ååº”çœ‹åˆ°å®å¡”é¢æ¿ä¸»ç•Œé¢ï¼ŒåŒ…å«ï¼š
- ç³»ç»Ÿèµ„æºä½¿ç”¨æƒ…å†µ
- å·²å®‰è£…è½¯ä»¶åˆ—è¡¨
- ç½‘ç«™ã€æ•°æ®åº“ã€FTPç­‰ç®¡ç†å…¥å£

---

## æ­¥éª¤2: æ£€æŸ¥MongoDBå®‰è£…çŠ¶æ€

### 2.1 è¿›å…¥è½¯ä»¶å•†åº—

ç‚¹å‡»å·¦ä¾§èœå•ï¼š**è½¯ä»¶å•†åº—** â†’ **å·²å®‰è£…**

### 2.2 æŸ¥æ‰¾MongoDB

åœ¨å·²å®‰è£…åˆ—è¡¨ä¸­æ‰¾åˆ° **MongoDB**ï¼Œæ£€æŸ¥ï¼š
- âœ… è¿è¡ŒçŠ¶æ€: åº”æ˜¾ç¤º"è¿è¡Œä¸­"
- âœ… ç‰ˆæœ¬ä¿¡æ¯: è®°å½•ç‰ˆæœ¬å·ï¼ˆå¦‚ 5.0.x, 6.0.xï¼‰
- âœ… å®‰è£…è·¯å¾„: é€šå¸¸åœ¨ `/www/server/mongodb/`

### 2.3 æŸ¥çœ‹MongoDBè®¾ç½®

ç‚¹å‡»MongoDBå³ä¾§çš„ **è®¾ç½®** æŒ‰é’®ï¼ŒæŸ¥çœ‹ï¼š
- **è¿è¡ŒçŠ¶æ€**: ç¡®è®¤"è¿è¡Œä¸­"
- **ç«¯å£**: é»˜è®¤27017ï¼ˆè®°å½•æ­¤ç«¯å£å·ï¼‰
- **é…ç½®æ–‡ä»¶**: `/www/server/mongodb/config.conf`
- **å¯åŠ¨å‚æ•°**: æŸ¥çœ‹æ˜¯å¦å¯ç”¨è®¤è¯ï¼ˆ--authï¼‰

---

## æ­¥éª¤3: é…ç½®MongoDBè¿œç¨‹è®¿é—®

### 3.1 ä¿®æ”¹MongoDBé…ç½®æ–‡ä»¶

åœ¨å®å¡”é¢æ¿ä¸­ï¼š
1. ç‚¹å‡» **æ–‡ä»¶** èœå•
2. å¯¼èˆªåˆ° `/www/server/mongodb/`
3. ç¼–è¾‘ `config.conf` æ–‡ä»¶

### 3.2 ä¿®æ”¹bindIpé…ç½®

æ‰¾åˆ° `net` éƒ¨åˆ†ï¼Œä¿®æ”¹ `bindIp`:

**ä¿®æ”¹å‰**:
```yaml
net:
  port: 27017
  bindIp: 127.0.0.1  # ä»…å…è®¸æœ¬åœ°è®¿é—®
```

**ä¿®æ”¹å**:
```yaml
net:
  port: 27017
  bindIp: 0.0.0.0    # å…è®¸æ‰€æœ‰IPè®¿é—®
  # æˆ–æŒ‡å®šå…·ä½“IP
  # bindIp: 127.0.0.1,your_client_ip
```

### 3.3 å¯ç”¨è®¤è¯ï¼ˆå¦‚æœæœªå¯ç”¨ï¼‰

ç¡®ä¿ `security` éƒ¨åˆ†å¯ç”¨äº†è®¤è¯ï¼š

```yaml
security:
  authorization: enabled
```

### 3.4 é‡å¯MongoDBæœåŠ¡

åœ¨å®å¡”é¢æ¿MongoDBè®¾ç½®ä¸­ï¼Œç‚¹å‡» **é‡å¯** æŒ‰é’®ã€‚

**éªŒè¯é‡å¯æˆåŠŸ**:
- çŠ¶æ€æ˜¾ç¤º"è¿è¡Œä¸­"
- æ— é”™è¯¯æ—¥å¿—

---

## æ­¥éª¤4: åˆ›å»ºæ•°æ®åº“å’Œç”¨æˆ·

### 4.1 è¿æ¥MongoDB Shell

åœ¨å®å¡”é¢æ¿MongoDBè®¾ç½®ä¸­ï¼Œç‚¹å‡» **ç»ˆç«¯** æˆ–ä½¿ç”¨SSHè¿æ¥æœåŠ¡å™¨ï¼š

```bash
/www/server/mongodb/bin/mongo
```

æˆ–å¦‚æœå·²å¯ç”¨è®¤è¯ï¼ˆä½¿ç”¨adminç”¨æˆ·ï¼‰ï¼š
```bash
/www/server/mongodb/bin/mongo -u admin -p --authenticationDatabase admin
```

### 4.2 åˆ›å»ºç®¡ç†å‘˜ç”¨æˆ·ï¼ˆå¦‚æœæ²¡æœ‰ï¼‰

åœ¨MongoDB Shellä¸­æ‰§è¡Œï¼š

```javascript
use admin

db.createUser({
  user: "admin",
  pwd: "your_strong_admin_password",  // è®¾ç½®å¼ºå¯†ç 
  roles: [
    { role: "root", db: "admin" }
  ]
})
```

**è®°å½•**:
- Adminç”¨æˆ·å: `admin`
- Adminå¯†ç : `your_strong_admin_password`ï¼ˆè‡ªå·±è®¾ç½®ï¼‰

### 4.3 åˆ›å»ºåº”ç”¨æ•°æ®åº“

```javascript
use intelligent_system
```

### 4.4 åˆ›å»ºåº”ç”¨ç”¨æˆ·

**é€‰é¡¹A: è¯»å†™æƒé™ç”¨æˆ·ï¼ˆåº”ç”¨ç¨‹åºä½¿ç”¨ï¼‰**

```javascript
use intelligent_system

db.createUser({
  user: "app_user",
  pwd: "your_app_password",  // è®¾ç½®å¼ºå¯†ç 
  roles: [
    { role: "readWrite", db: "intelligent_system" }
  ]
})
```

**é€‰é¡¹B: åªè¯»æƒé™ç”¨æˆ·ï¼ˆæ•°æ®åˆ†æä½¿ç”¨ï¼‰**

```javascript
use intelligent_system

db.createUser({
  user: "ai_analyst",
  pwd: "your_analyst_password",  // è®¾ç½®å¼ºå¯†ç 
  roles: [
    { role: "read", db: "intelligent_system" }
  ]
})
```

**è®°å½•åˆ›å»ºçš„ç”¨æˆ·ä¿¡æ¯**:
```
æ•°æ®åº“: intelligent_system
åº”ç”¨ç”¨æˆ·: app_user / your_app_password
åˆ†æç”¨æˆ·: ai_analyst / your_analyst_password
```

### 4.5 éªŒè¯ç”¨æˆ·åˆ›å»º

```javascript
use intelligent_system
db.getUsers()
```

åº”è¯¥çœ‹åˆ°åˆšåˆ›å»ºçš„ç”¨æˆ·åˆ—è¡¨ã€‚

### 4.6 æµ‹è¯•ç”¨æˆ·æƒé™

é€€å‡ºå¹¶ä½¿ç”¨æ–°ç”¨æˆ·é‡æ–°è¿æ¥ï¼š
```bash
/www/server/mongodb/bin/mongo \
  -u app_user \
  -p your_app_password \
  --authenticationDatabase intelligent_system \
  intelligent_system
```

æµ‹è¯•æ’å…¥æ•°æ®ï¼š
```javascript
db.test_collection.insertOne({test: "data"})
db.test_collection.find()
db.test_collection.deleteOne({test: "data"})
```

---

## æ­¥éª¤5: é…ç½®é˜²ç«å¢™è§„åˆ™

### 5.1 åœ¨å®å¡”é¢æ¿é…ç½®é˜²ç«å¢™

1. ç‚¹å‡» **å®‰å…¨** èœå•
2. æ‰¾åˆ° **é˜²ç«å¢™** è®¾ç½®
3. ç‚¹å‡» **æ·»åŠ è§„åˆ™**

### 5.2 æ·»åŠ MongoDBç«¯å£

**é…ç½®å¦‚ä¸‹**:
```
ç«¯å£: 27017
åè®®: TCP
ç­–ç•¥: æ”¾è¡Œ
å¤‡æ³¨: MongoDBæ•°æ®åº“ç«¯å£
```

### 5.3 é…ç½®IPç™½åå•ï¼ˆæ¨èï¼‰

**é€‰é¡¹A: é™åˆ¶ç‰¹å®šIPè®¿é—®ï¼ˆæ¨èï¼‰**
```
ç«¯å£: 27017
åè®®: TCP
æ¥æºIP: your_office_ip  # ä½ çš„åŠå…¬å®¤æˆ–å®¶åº­IP
ç­–ç•¥: æ”¾è¡Œ
å¤‡æ³¨: MongoDB - é™åˆ¶IPè®¿é—®
```

**é€‰é¡¹B: å¼€æ”¾æ‰€æœ‰IPï¼ˆä¸æ¨èç”Ÿäº§ç¯å¢ƒï¼‰**
```
ç«¯å£: 27017
åè®®: TCP
æ¥æºIP: 0.0.0.0/0
ç­–ç•¥: æ”¾è¡Œ
å¤‡æ³¨: MongoDB - æ‰€æœ‰IPå¯è®¿é—®
```

### 5.4 éªŒè¯é˜²ç«å¢™è§„åˆ™

åœ¨ä½ çš„æœ¬åœ°ç”µè„‘æµ‹è¯•ç«¯å£è¿é€šæ€§ï¼š

```bash
# æ–¹æ³•1: telnet
telnet hancens.top 27017

# æ–¹æ³•2: nc (netcat)
nc -zv hancens.top 27017

# æ–¹æ³•3: nmap
nmap -p 27017 hancens.top
```

**æˆåŠŸè¾“å‡ºç¤ºä¾‹**:
```
Connection to hancens.top port 27017 [tcp/*] succeeded!
```

---

## æ­¥éª¤6: æµ‹è¯•è¿æ¥

### 6.1 ä½¿ç”¨MongoDB Compassæµ‹è¯•

**ä¸‹è½½MongoDB Compass**: https://www.mongodb.com/try/download/compass

**è¿æ¥å­—ç¬¦ä¸²**:
```
mongodb://app_user:your_app_password@hancens.top:27017/intelligent_system?authSource=intelligent_system
```

**è¿æ¥æ­¥éª¤**:
1. æ‰“å¼€MongoDB Compass
2. ç²˜è´´è¿æ¥å­—ç¬¦ä¸²
3. ç‚¹å‡» **Connect**
4. éªŒè¯èƒ½çœ‹åˆ° `intelligent_system` æ•°æ®åº“

### 6.2 ä½¿ç”¨Pythonæµ‹è¯•

åˆ›å»ºæµ‹è¯•è„šæœ¬ `test_connection.py`:

```python
from pymongo import MongoClient
from pymongo.errors import ConnectionFailure, OperationFailure

# è¿æ¥å­—ç¬¦ä¸²
MONGODB_URL = "mongodb://app_user:your_app_password@hancens.top:27017/intelligent_system?authSource=intelligent_system"

try:
    # è¿æ¥MongoDB
    client = MongoClient(MONGODB_URL, serverSelectionTimeoutMS=5000)

    # æµ‹è¯•è¿æ¥
    client.admin.command('ping')
    print("âœ… MongoDBè¿æ¥æˆåŠŸ!")

    # è·å–æ•°æ®åº“
    db = client['intelligent_system']

    # æµ‹è¯•å†™å…¥
    test_collection = db['connection_test']
    result = test_collection.insert_one({'test': 'connection', 'timestamp': 'now'})
    print(f"âœ… å†™å…¥æµ‹è¯•æˆåŠŸ! ID: {result.inserted_id}")

    # æµ‹è¯•è¯»å–
    doc = test_collection.find_one({'test': 'connection'})
    print(f"âœ… è¯»å–æµ‹è¯•æˆåŠŸ! æ•°æ®: {doc}")

    # æ¸…ç†æµ‹è¯•æ•°æ®
    test_collection.delete_one({'_id': result.inserted_id})
    print("âœ… æ¸…ç†æµ‹è¯•æ•°æ®æˆåŠŸ!")

    # å…³é—­è¿æ¥
    client.close()
    print("âœ… æ‰€æœ‰æµ‹è¯•é€šè¿‡!")

except ConnectionFailure:
    print("âŒ è¿æ¥å¤±è´¥: æ— æ³•è¿æ¥åˆ°MongoDBæœåŠ¡å™¨")
    print("   è¯·æ£€æŸ¥:")
    print("   1. æœåŠ¡å™¨åœ°å€å’Œç«¯å£æ˜¯å¦æ­£ç¡®")
    print("   2. é˜²ç«å¢™æ˜¯å¦å¼€æ”¾27017ç«¯å£")
    print("   3. MongoDBæœåŠ¡æ˜¯å¦è¿è¡Œ")

except OperationFailure as e:
    print(f"âŒ è®¤è¯å¤±è´¥: {e}")
    print("   è¯·æ£€æŸ¥:")
    print("   1. ç”¨æˆ·åå’Œå¯†ç æ˜¯å¦æ­£ç¡®")
    print("   2. authSourceå‚æ•°æ˜¯å¦æ­£ç¡®")
    print("   3. ç”¨æˆ·æƒé™æ˜¯å¦å·²é…ç½®")

except Exception as e:
    print(f"âŒ æœªçŸ¥é”™è¯¯: {e}")
```

è¿è¡Œæµ‹è¯•ï¼š
```bash
python test_connection.py
```

### 6.3 ä½¿ç”¨é¡¹ç›®è¾…åŠ©è„šæœ¬æµ‹è¯•

```bash
python scripts/mongodb_connection_helper.py \
  --connection "mongodb://app_user:your_app_password@hancens.top:27017/intelligent_system?authSource=intelligent_system" \
  --overview
```

---

## æ­¥éª¤7: é…ç½®é¡¹ç›®ç¯å¢ƒå˜é‡

### 7.1 æ›´æ–°.envæ–‡ä»¶

ç¼–è¾‘é¡¹ç›®æ ¹ç›®å½•çš„ `.env` æ–‡ä»¶ï¼š

```bash
# MongoDBé…ç½®
MONGODB_URL=mongodb://app_user:your_app_password@hancens.top:27017/intelligent_system?authSource=intelligent_system
MONGODB_DB_NAME=intelligent_system
MONGODB_MAX_POOL_SIZE=100
MONGODB_MIN_POOL_SIZE=10
```

**å‚æ•°è¯´æ˜**:
- `MONGODB_URL`: å®Œæ•´çš„è¿æ¥å­—ç¬¦ä¸²
  - æ ¼å¼: `mongodb://[ç”¨æˆ·å]:[å¯†ç ]@[ä¸»æœº]:[ç«¯å£]/[æ•°æ®åº“]?authSource=[è®¤è¯æ•°æ®åº“]`
  - ç”¨æˆ·å: `app_user`ï¼ˆæ­¥éª¤4.4åˆ›å»ºçš„ï¼‰
  - å¯†ç : `your_app_password`ï¼ˆæ­¥éª¤4.4è®¾ç½®çš„ï¼‰
  - ä¸»æœº: `hancens.top`
  - ç«¯å£: `27017`
  - æ•°æ®åº“: `intelligent_system`
  - authSource: `intelligent_system`ï¼ˆç”¨æˆ·åˆ›å»ºæ—¶çš„æ•°æ®åº“ï¼‰

- `MONGODB_DB_NAME`: æ•°æ®åº“åç§°
- `MONGODB_MAX_POOL_SIZE`: æœ€å¤§è¿æ¥æ± å¤§å°ï¼ˆé»˜è®¤100ï¼‰
- `MONGODB_MIN_POOL_SIZE`: æœ€å°è¿æ¥æ± å¤§å°ï¼ˆé»˜è®¤10ï¼‰

### 7.2 éªŒè¯é…ç½®

å¯åŠ¨åº”ç”¨ç¨‹åºï¼š
```bash
uvicorn src.main:app --reload
```

æ£€æŸ¥å¯åŠ¨æ—¥å¿—ï¼š
```
MongoDBè¿æ¥æˆåŠŸ: intelligent_system
æ•°æ®åº“ç´¢å¼•åˆ›å»ºå®Œæˆ
âœ… å³æ—¶æœç´¢ä»»åŠ¡ç´¢å¼•åˆ›å»ºå®Œæˆ
âœ… å³æ—¶æœç´¢ç»“æœç´¢å¼•åˆ›å»ºå®Œæˆ
```

### 7.3 æµ‹è¯•APIç«¯ç‚¹

è®¿é—®å¥åº·æ£€æŸ¥ç«¯ç‚¹ï¼š
```bash
curl http://localhost:8000/health
```

åº”è¯¥è¿”å›ï¼š
```json
{
  "status": "ok",
  "database": "connected"
}
```

---

## ğŸ” å®‰å…¨æœ€ä½³å®è·µ

### 1. å¯†ç ç®¡ç†

âœ… **å¼ºå¯†ç è¦æ±‚**:
- è‡³å°‘16ä¸ªå­—ç¬¦
- åŒ…å«å¤§å°å†™å­—æ¯ã€æ•°å­—ã€ç‰¹æ®Šç¬¦å·
- ä¸ä½¿ç”¨å¸¸è§å¯†ç æˆ–å­—å…¸è¯æ±‡

âŒ **ä¸è¦**:
- ä½¿ç”¨ç®€å•å¯†ç ï¼ˆå¦‚123456ã€passwordï¼‰
- åœ¨ä»£ç ä¸­ç¡¬ç¼–ç å¯†ç 
- æäº¤.envæ–‡ä»¶åˆ°Gitä»“åº“

### 2. ç½‘ç»œå®‰å…¨

âœ… **IPç™½åå•**:
```
åªå…è®¸ç‰¹å®šIPè®¿é—®MongoDBç«¯å£
```

âœ… **éæ ‡å‡†ç«¯å£**ï¼ˆå¯é€‰ï¼‰:
```
å°†MongoDBç«¯å£ä»27017æ”¹ä¸ºè‡ªå®šä¹‰ç«¯å£ï¼ˆå¦‚37017ï¼‰
åœ¨é˜²ç«å¢™ä¸­é…ç½®ç«¯å£æ˜ å°„
```

âœ… **SSL/TLSåŠ å¯†**ï¼ˆæ¨èç”Ÿäº§ç¯å¢ƒï¼‰:
```yaml
# MongoDBé…ç½®æ–‡ä»¶
net:
  ssl:
    mode: requireSSL
    PEMKeyFile: /path/to/mongodb.pem
```

è¿æ¥å­—ç¬¦ä¸²æ·»åŠ å‚æ•°ï¼š
```
mongodb://user:pass@host:port/db?authSource=db&ssl=true
```

### 3. æƒé™ç®¡ç†

âœ… **æœ€å°æƒé™åŸåˆ™**:
- åº”ç”¨ç”¨æˆ·: åªæˆäºˆreadWriteæƒé™
- åˆ†æç”¨æˆ·: åªæˆäºˆreadæƒé™
- ä¸ä½¿ç”¨rootç”¨æˆ·è¿æ¥åº”ç”¨

âœ… **å®šæœŸå®¡è®¡**:
```javascript
// æŸ¥çœ‹æ‰€æœ‰ç”¨æˆ·
use intelligent_system
db.getUsers()

// æŸ¥çœ‹ç”¨æˆ·æƒé™
db.getUser("app_user")
```

### 4. ç›‘æ§å’Œæ—¥å¿—

âœ… **å¯ç”¨MongoDBæ—¥å¿—**:
```yaml
# MongoDBé…ç½®æ–‡ä»¶
systemLog:
  destination: file
  path: /www/server/mongodb/logs/mongodb.log
  logAppend: true
```

âœ… **ç›‘æ§è¿æ¥**:
```javascript
// æŸ¥çœ‹å½“å‰è¿æ¥
db.currentOp()

// æŸ¥çœ‹æœåŠ¡å™¨çŠ¶æ€
db.serverStatus()
```

---

## ğŸš¨ æ•…éšœæ’æŸ¥

### é—®é¢˜1: æ— æ³•è¿æ¥åˆ°MongoDB

**é”™è¯¯ä¿¡æ¯**:
```
ConnectionFailure: [Errno 111] Connection refused
æˆ–
ServerSelectionTimeoutError
```

**å¯èƒ½åŸå› åŠè§£å†³æ–¹æ¡ˆ**:

1. **MongoDBæœåŠ¡æœªè¿è¡Œ**
   - åœ¨å®å¡”é¢æ¿æ£€æŸ¥MongoDBè¿è¡ŒçŠ¶æ€
   - ç‚¹å‡»"å¯åŠ¨"æŒ‰é’®
   - æŸ¥çœ‹æ—¥å¿—ï¼š`/www/server/mongodb/logs/mongodb.log`

2. **é˜²ç«å¢™æœªå¼€æ”¾ç«¯å£**
   - å®å¡”é¢æ¿ â†’ å®‰å…¨ â†’ é˜²ç«å¢™
   - æ·»åŠ 27017ç«¯å£è§„åˆ™
   - æ£€æŸ¥æœåŠ¡å™¨äº‘å¹³å°å®‰å…¨ç»„è§„åˆ™

3. **bindIpé…ç½®é”™è¯¯**
   - æ£€æŸ¥ `config.conf` ä¸­çš„ `bindIp`
   - åº”è®¾ç½®ä¸º `0.0.0.0` æˆ–åŒ…å«å®¢æˆ·ç«¯IP
   - ä¿®æ”¹åé‡å¯MongoDB

4. **ç½‘ç»œè¿é€šæ€§é—®é¢˜**
   - æµ‹è¯•: `telnet hancens.top 27017`
   - æµ‹è¯•: `ping hancens.top`
   - æ£€æŸ¥æœ¬åœ°ç½‘ç»œå’ŒDNS

### é—®é¢˜2: è®¤è¯å¤±è´¥

**é”™è¯¯ä¿¡æ¯**:
```
OperationFailure: Authentication failed
```

**å¯èƒ½åŸå› åŠè§£å†³æ–¹æ¡ˆ**:

1. **ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯**
   - ç¡®è®¤ç”¨æˆ·åæ‹¼å†™æ­£ç¡®
   - ç¡®è®¤å¯†ç æ²¡æœ‰å¤šä½™ç©ºæ ¼
   - åŒºåˆ†å¤§å°å†™

2. **authSourceå‚æ•°é”™è¯¯**
   - åº”ä¸åˆ›å»ºç”¨æˆ·æ—¶çš„æ•°æ®åº“ä¸€è‡´
   - é€šå¸¸æ˜¯ `admin` æˆ– `intelligent_system`
   - ç¤ºä¾‹: `?authSource=intelligent_system`

3. **ç”¨æˆ·ä¸å­˜åœ¨æˆ–æƒé™ä¸è¶³**
   ```javascript
   // æ£€æŸ¥ç”¨æˆ·æ˜¯å¦å­˜åœ¨
   use intelligent_system
   db.getUsers()

   // é‡æ–°åˆ›å»ºç”¨æˆ·
   db.createUser({
     user: "app_user",
     pwd: "your_password",
     roles: [{role: "readWrite", db: "intelligent_system"}]
   })
   ```

4. **è®¤è¯æœªå¯ç”¨**
   - æ£€æŸ¥MongoDBé…ç½®æ–‡ä»¶
   - ç¡®è®¤ `security.authorization: enabled`
   - é‡å¯MongoDBæœåŠ¡

### é—®é¢˜3: è¿æ¥è¶…æ—¶

**é”™è¯¯ä¿¡æ¯**:
```
pymongo.errors.ServerSelectionTimeoutError: timed out
```

**å¯èƒ½åŸå› åŠè§£å†³æ–¹æ¡ˆ**:

1. **é˜²ç«å¢™è§„åˆ™é…ç½®ä¸å®Œæ•´**
   - æ£€æŸ¥å®å¡”é¢æ¿é˜²ç«å¢™
   - æ£€æŸ¥äº‘å¹³å°å®‰å…¨ç»„ï¼ˆé˜¿é‡Œäº‘ã€è…¾è®¯äº‘ç­‰ï¼‰
   - ä¸¤è€…éƒ½éœ€è¦å¼€æ”¾ç«¯å£

2. **MongoDBæœåŠ¡å“åº”æ…¢**
   - æ£€æŸ¥æœåŠ¡å™¨èµ„æºä½¿ç”¨æƒ…å†µ
   - å¢åŠ è¿æ¥è¶…æ—¶æ—¶é—´:
     ```python
     MongoClient(url, serverSelectionTimeoutMS=10000)
     ```

3. **DNSè§£æé—®é¢˜**
   - æµ‹è¯•åŸŸåè§£æ: `nslookup hancens.top`
   - å°è¯•ä½¿ç”¨IPåœ°å€ä»£æ›¿åŸŸå
   - æ£€æŸ¥æœ¬åœ°DNSè®¾ç½®

### é—®é¢˜4: æƒé™ä¸è¶³

**é”™è¯¯ä¿¡æ¯**:
```
not authorized on intelligent_system to execute command
```

**è§£å†³æ–¹æ¡ˆ**:

```javascript
// è¿æ¥åˆ°adminæ•°æ®åº“ï¼ˆä½¿ç”¨adminç”¨æˆ·ï¼‰
use admin
db.auth("admin", "admin_password")

// åˆ‡æ¢åˆ°ç›®æ ‡æ•°æ®åº“
use intelligent_system

// æ›´æ–°ç”¨æˆ·æƒé™
db.grantRolesToUser("app_user", [
  {role: "readWrite", db: "intelligent_system"}
])

// éªŒè¯æƒé™
db.getUser("app_user")
```

### é—®é¢˜5: è¿æ¥å­—ç¬¦ä¸²æ ¼å¼é”™è¯¯

**å¸¸è§é”™è¯¯**:

âŒ é”™è¯¯ç¤ºä¾‹:
```
# ç¼ºå°‘authSource
mongodb://user:pass@host:port/db

# å¯†ç åŒ…å«ç‰¹æ®Šå­—ç¬¦æœªç¼–ç 
mongodb://user:p@ss@host:port/db

# ç«¯å£å·é”™è¯¯
mongodb://user:pass@host:8080/db
```

âœ… æ­£ç¡®ç¤ºä¾‹:
```
# å®Œæ•´æ ¼å¼
mongodb://user:pass@host:27017/db?authSource=db

# å¯†ç URLç¼–ç 
mongodb://user:p%40ss@host:27017/db?authSource=db

# æ­£ç¡®ç«¯å£
mongodb://user:pass@host:27017/db?authSource=db
```

**å¯†ç ç‰¹æ®Šå­—ç¬¦ç¼–ç è¡¨**:
| å­—ç¬¦ | ç¼–ç  |
|------|------|
| `@` | `%40` |
| `:` | `%3A` |
| `/` | `%2F` |
| `?` | `%3F` |
| `#` | `%23` |
| `&` | `%26` |

---

## ğŸ“Š è¿æ¥ä¿¡æ¯é€ŸæŸ¥è¡¨

### å½“å‰é…ç½®

| é¡¹ç›® | å€¼ | è¯´æ˜ |
|------|-----|------|
| **å®å¡”é¢æ¿** | | |
| é¢æ¿åœ°å€ | https://hancens.top:18314/cbece14e | Webç®¡ç†ç•Œé¢ |
| é¢æ¿ç”¨æˆ·å | mbjqhmkm | ä»…ç”¨äºç™»å½•é¢æ¿ |
| é¢æ¿å¯†ç  | asjklquio1z | ä»…ç”¨äºç™»å½•é¢æ¿ |
| **MongoDBæœåŠ¡** | | |
| æœåŠ¡å™¨åœ°å€ | hancens.top | åŸŸåæˆ–IP |
| MongoDBç«¯å£ | 27017 | é»˜è®¤ç«¯å£ï¼ˆéœ€åœ¨å®å¡”ç¡®è®¤ï¼‰ |
| æ•°æ®åº“å | intelligent_system | åº”ç”¨æ•°æ®åº“ |
| **MongoDBç”¨æˆ·** | | |
| Adminç”¨æˆ· | admin | ç®¡ç†å‘˜è´¦æˆ· |
| Adminå¯†ç  | your_strong_admin_password | æ­¥éª¤4.2è®¾ç½® |
| åº”ç”¨ç”¨æˆ· | app_user | åº”ç”¨ç¨‹åºä½¿ç”¨ |
| åº”ç”¨å¯†ç  | your_app_password | æ­¥éª¤4.4è®¾ç½® |
| åˆ†æç”¨æˆ· | ai_analyst | æ•°æ®åˆ†æä½¿ç”¨ |
| åˆ†æå¯†ç  | your_analyst_password | æ­¥éª¤4.4è®¾ç½® |

### è¿æ¥å­—ç¬¦ä¸²æ¨¡æ¿

**åº”ç”¨ç¨‹åºè¿æ¥ï¼ˆè¯»å†™ï¼‰**:
```
mongodb://app_user:your_app_password@hancens.top:27017/intelligent_system?authSource=intelligent_system
```

**æ•°æ®åˆ†æè¿æ¥ï¼ˆåªè¯»ï¼‰**:
```
mongodb://ai_analyst:your_analyst_password@hancens.top:27017/intelligent_system?authSource=intelligent_system
```

**ç®¡ç†å‘˜è¿æ¥**:
```
mongodb://admin:your_strong_admin_password@hancens.top:27017/admin?authSource=admin
```

### é¡¹ç›®.envé…ç½®

```bash
# MongoDBé…ç½®
MONGODB_URL=mongodb://app_user:your_app_password@hancens.top:27017/intelligent_system?authSource=intelligent_system
MONGODB_DB_NAME=intelligent_system
MONGODB_MAX_POOL_SIZE=100
MONGODB_MIN_POOL_SIZE=10
```

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- **éƒ¨ç½²æŒ‡å—**: `docs/DEPLOYMENT_BAOTA_MONGODB.md` - å®Œæ•´çš„å®å¡”MongoDBéƒ¨ç½²æ–‡æ¡£
- **è®¿é—®æŒ‡å—**: `docs/MONGODB_ACCESS_GUIDE.md` - å›¢é˜Ÿæˆå‘˜æ•°æ®åº“è®¿é—®è¯´æ˜
- **è¿æ¥è„šæœ¬**: `scripts/mongodb_connection_helper.py` - Pythonè¿æ¥æµ‹è¯•å·¥å…·

---

## ğŸ“ æŠ€æœ¯æ”¯æŒ

**é…ç½®è¿‡ç¨‹ä¸­é‡åˆ°é—®é¢˜ï¼Ÿ**

1. æŸ¥çœ‹æœ¬æ–‡æ¡£çš„"æ•…éšœæ’æŸ¥"éƒ¨åˆ†
2. æ£€æŸ¥MongoDBæ—¥å¿—: `/www/server/mongodb/logs/mongodb.log`
3. å‚è€ƒå®Œæ•´éƒ¨ç½²æ–‡æ¡£: `docs/DEPLOYMENT_BAOTA_MONGODB.md`
4. è”ç³»ç³»ç»Ÿç®¡ç†å‘˜

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0
**åˆ›å»ºæ—¥æœŸ**: 2025-10-16
**é€‚ç”¨ç¯å¢ƒ**: å®å¡”é¢æ¿ + MongoDB
**ç»´æŠ¤è€…**: æŠ€æœ¯å›¢é˜Ÿ
