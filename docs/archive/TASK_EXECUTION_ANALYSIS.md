# å®šæ—¶ä»»åŠ¡æ‰§è¡Œåˆ†ææŠ¥å‘Š

**ä»»åŠ¡ID**: `237408060762787840`
**ä»»åŠ¡åç§°**: æµ‹è¯•ä»»åŠ¡ 10 æœˆ 17 æ—¥
**åˆ†ææ—¶é—´**: 2025-10-17 14:08
**çŠ¶æ€**: âš ï¸ **ä»»åŠ¡å·²å¯åŠ¨å¹¶æ‰§è¡Œ,ä½†æœç´¢å¤±è´¥**

---

## ğŸ“Š æ ¸å¿ƒå‘ç°

### âœ… ä»»åŠ¡è°ƒåº¦æ­£å¸¸

**è¯æ®1: ä»»åŠ¡æˆåŠŸåŠ è½½åˆ°è°ƒåº¦å™¨**
```
[2025-10-17 13:36:13] æ›´æ–°ä»»åŠ¡æˆåŠŸ: æµ‹è¯•ä»»åŠ¡ 10 æœˆ 17 æ—¥ (ID: 237408060762787840)
[2025-10-17 13:36:13] âœ… ä»»åŠ¡å·²è°ƒåº¦: æµ‹è¯•ä»»åŠ¡ 10 æœˆ 17 æ—¥ - æ¯å°æ—¶æ‰§è¡Œä¸€æ¬¡
[2025-10-17 13:36:13] ğŸ“‹ åŠ è½½äº† 1 ä¸ªæ´»è·ƒæœç´¢ä»»åŠ¡
[2025-10-17 13:36:13] ğŸš€ å®šæ—¶æœç´¢ä»»åŠ¡è°ƒåº¦å™¨å¯åŠ¨æˆåŠŸ
```

**è¯æ®2: ä»»åŠ¡æŒ‰æ—¶æ‰§è¡Œ**
```
[2025-10-17 14:00:00] ğŸ” å¼€å§‹æ‰§è¡Œæœç´¢ä»»åŠ¡: 237408060762787840
[2025-10-17 14:00:00] ğŸ” ä½¿ç”¨å…³é”®è¯æœç´¢æ¨¡å¼: ç‰¹æœ—æ™®ã€è´¸æ˜“æˆ˜ã€å…³ç¨
```

**è¯æ®3: ä»»åŠ¡å®Œæˆæ‰§è¡Œå‘¨æœŸ**
```
[2025-10-17 14:00:00] âœ… æœç´¢ä»»åŠ¡æ‰§è¡Œå®Œæˆ: æµ‹è¯•ä»»åŠ¡ 10 æœˆ 17 æ—¥ | ç»“æœæ•°: 0 | è€—æ—¶: 0.34s | ä¸‹æ¬¡æ‰§è¡Œ: 2025-10-17 15:00:00
```

### âŒ æœç´¢APIè°ƒç”¨å¤±è´¥

**é”™è¯¯ç±»å‹**: ç½‘ç»œè¿æ¥é”™è¯¯
**é”™è¯¯ä¿¡æ¯**: `ConnectError: [Errno 8] nodename nor servname provided, or not known`
**å‘ç”Ÿæ—¶é—´**: 2025-10-17 14:00:00
**å½±å“**: æ— æ³•è·å–æœç´¢ç»“æœ,è¿”å›0æ¡æ•°æ®

**å®Œæ•´é”™è¯¯å †æ ˆ**:
```
[2025-10-17 14:00:00] ğŸ” æ­£åœ¨è°ƒç”¨ Firecrawl API: https://api.firecrawl.dev/v2/search
[2025-10-17 14:00:00] ğŸ“ è¯·æ±‚å‚æ•°: {
    'query': 'ç‰¹æœ—æ™®ã€è´¸æ˜“æˆ˜ã€å…³ç¨',
    'limit': 10,
    'lang': 'en',
    'scrapeOptions': {'formats': ['markdown', 'html', 'links'], 'onlyMainContent': True},
    'tbs': 'qdr:m'
}
[2025-10-17 14:00:00] âŒ æœç´¢å‘ç”Ÿæ„å¤–é”™è¯¯: ConnectError: [Errno 8] nodename nor servname provided, or not known
```

---

## ğŸ” é—®é¢˜è¯Šæ–­

### 1. ä»»åŠ¡è°ƒåº¦å±‚é¢ âœ… æ­£å¸¸

| æ£€æŸ¥é¡¹ | çŠ¶æ€ | è¯´æ˜ |
|--------|------|------|
| ä»»åŠ¡æ˜¯å¦æœ‰ `is_active` å­—æ®µ | âœ… æ˜¯ | å·²é€šè¿‡æ•°æ®åº“è¿ç§»ä¿®å¤ |
| ä»»åŠ¡æ˜¯å¦åŠ è½½åˆ°è°ƒåº¦å™¨ | âœ… æ˜¯ | æ—¥å¿—æ˜¾ç¤º"åŠ è½½äº† 1 ä¸ªæ´»è·ƒæœç´¢ä»»åŠ¡" |
| ä»»åŠ¡æ˜¯å¦æŒ‰æ—¶è§¦å‘ | âœ… æ˜¯ | 14:00:00å‡†æ—¶æ‰§è¡Œ |
| ä¸‹æ¬¡æ‰§è¡Œæ—¶é—´æ˜¯å¦æ­£ç¡® | âœ… æ˜¯ | 15:00:00 (æ¯å°æ—¶ä¸€æ¬¡) |

### 2. æœç´¢æ‰§è¡Œå±‚é¢ âŒ å¤±è´¥

| æ£€æŸ¥é¡¹ | çŠ¶æ€ | è¯´æ˜ |
|--------|------|------|
| Firecrawl APIå¯è¾¾æ€§ | âŒ å¦ | DNSè§£ææˆ–ç½‘ç»œè¿æ¥å¤±è´¥ |
| æœç´¢è¯·æ±‚æ˜¯å¦å‘é€ | âš ï¸ å°è¯•å‘é€ä½†å¤±è´¥ | æ— æ³•å»ºç«‹è¿æ¥ |
| æœç´¢ç»“æœæ•°é‡ | âŒ 0æ¡ | APIè°ƒç”¨å¤±è´¥å¯¼è‡´ |
| æ˜¯å¦ä¿å­˜åˆ°æ•°æ®åº“ | âŒ å¦ | æ²¡æœ‰ç»“æœå¯ä¿å­˜ |

### 3. æ•°æ®åº“å±‚é¢ âœ… æ­£å¸¸

| æ£€æŸ¥é¡¹ | çŠ¶æ€ | è¯´æ˜ |
|--------|------|------|
| MongoDBè¿æ¥ | âœ… æ­£å¸¸ | "MongoDBè¿æ¥æˆåŠŸ: intelligent_system" |
| ä»»åŠ¡æ›´æ–°æˆåŠŸ | âœ… æ˜¯ | "æ›´æ–°ä»»åŠ¡æˆåŠŸ" |
| search_resultsé›†åˆ | âš ï¸ ç©º | å› æœç´¢å¤±è´¥æ— æ•°æ®å†™å…¥ |

---

## ğŸ¯ æ ¹æœ¬åŸå› åˆ†æ

### ç›´æ¥åŸå› 
**Firecrawl APIç½‘ç»œè¿æ¥å¤±è´¥**

é”™è¯¯ç  `[Errno 8] nodename nor servname provided, or not known` è¡¨ç¤ºç³»ç»Ÿæ— æ³•è§£æåŸŸå `api.firecrawl.dev`ã€‚

### å¯èƒ½çš„æ ¹æœ¬åŸå› 

1. **DNSè§£æé—®é¢˜** (æœ€å¯èƒ½)
   - æœ¬åœ°DNSæœåŠ¡å™¨æ— æ³•è§£æ `api.firecrawl.dev`
   - ç½‘ç»œé…ç½®é—®é¢˜å¯¼è‡´DNSæŸ¥è¯¢å¤±è´¥
   - é˜²ç«å¢™/ä»£ç†é˜»æ­¢äº†DNSæŸ¥è¯¢

2. **ç½‘ç»œè¿æ¥é—®é¢˜**
   - ç³»ç»Ÿæœªè¿æ¥åˆ°äº’è”ç½‘
   - é˜²ç«å¢™è§„åˆ™é˜»æ­¢äº†å¯¹å¤–éƒ¨APIçš„è¿æ¥
   - ä»£ç†é…ç½®é—®é¢˜

3. **FirecrawlæœåŠ¡é—®é¢˜** (ä¸å¤ªå¯èƒ½)
   - Firecrawl APIæœåŠ¡æš‚æ—¶ä¸å¯ç”¨
   - APIåŸŸåå˜æ›´

---

## ğŸ”§ è§£å†³æ–¹æ¡ˆ

### ç«‹å³éªŒè¯æ­¥éª¤

#### 1. éªŒè¯ç½‘ç»œè¿æ¥
```bash
# æµ‹è¯•DNSè§£æ
nslookup api.firecrawl.dev

# æµ‹è¯•ç½‘ç»œè¿é€šæ€§
ping api.firecrawl.dev

# æµ‹è¯•HTTPSè¿æ¥
curl -v https://api.firecrawl.dev/v2/search
```

#### 2. éªŒè¯APIå¯†é’¥
```bash
# æ£€æŸ¥ç¯å¢ƒå˜é‡
echo $FIRECRAWL_API_KEY

# æµ‹è¯•APIè°ƒç”¨
curl -X POST https://api.firecrawl.dev/v2/search \
  -H "Authorization: Bearer $FIRECRAWL_API_KEY" \
  -H "Content-Type: application/json" \
  -d '{
    "query": "test",
    "limit": 5
  }'
```

#### 3. æ£€æŸ¥ç³»ç»ŸDNSé…ç½®
```bash
# æŸ¥çœ‹DNSé…ç½®
cat /etc/resolv.conf

# æŸ¥çœ‹ç³»ç»Ÿç½‘ç»œçŠ¶æ€
ifconfig

# æŸ¥çœ‹è·¯ç”±è¡¨
netstat -rn
```

### ä¸´æ—¶è§£å†³æ–¹æ¡ˆ

å¦‚æœæ˜¯DNSé—®é¢˜,å¯ä»¥å°è¯•:

1. **æ›´æ¢DNSæœåŠ¡å™¨**
   ```bash
   # ä¸´æ—¶è®¾ç½®DNSä¸ºGoogle Public DNS
   # åœ¨ /etc/resolv.conf æ·»åŠ :
   nameserver 8.8.8.8
   nameserver 8.8.4.4
   ```

2. **æ·»åŠ hostsæ–‡ä»¶æ˜ å°„**
   ```bash
   # æŸ¥è¯¢ Firecrawl çš„çœŸå®IPå¹¶æ·»åŠ åˆ° /etc/hosts
   # (éœ€è¦ä»å…¶ä»–èƒ½è¿æ¥çš„æœºå™¨è·å–IP)
   ```

3. **é…ç½®ä»£ç†**
   ```bash
   # å¦‚æœéœ€è¦é€šè¿‡ä»£ç†è®¿é—®
   export HTTP_PROXY=http://proxy.example.com:8080
   export HTTPS_PROXY=http://proxy.example.com:8080
   ```

### é•¿æœŸè§£å†³æ–¹æ¡ˆ

1. **å¢åŠ é‡è¯•æœºåˆ¶**
   - å½“å‰ç³»ç»Ÿå·²æœ‰ `FIRECRAWL_MAX_RETRIES: 3` é…ç½®
   - å¯ä»¥å¢åŠ é‡è¯•æ¬¡æ•°å’Œé‡è¯•é—´éš”

2. **æ·»åŠ å¥åº·æ£€æŸ¥**
   - åœ¨ä»»åŠ¡æ‰§è¡Œå‰æ£€æŸ¥APIå¯è¾¾æ€§
   - å¦‚æœAPIä¸å¯è¾¾,è·³è¿‡æœ¬æ¬¡æ‰§è¡Œå¹¶è®°å½•æ—¥å¿—

3. **å®ç°é™çº§ç­–ç•¥**
   - å‡†å¤‡å¤‡ç”¨æœç´¢æº
   - APIå¤±è´¥æ—¶ä½¿ç”¨å¤‡ç”¨æœç´¢å¼•æ“

4. **ç›‘æ§å‘Šè­¦**
   - è®¾ç½®APIè°ƒç”¨å¤±è´¥å‘Šè­¦
   - ç›‘æ§ç½‘ç»œè¿é€šæ€§

---

## ğŸ“ˆ å»ºè®®çš„ä»£ç æ”¹è¿›

### 1. å¢å¼ºé”™è¯¯å¤„ç†å’Œé‡è¯•

`src/infrastructure/search/firecrawl_search_adapter.py`:
```python
async def search(self, query: str, limit: int = 10, **kwargs) -> List[SearchResult]:
    """æœç´¢æ–¹æ³•å¢å¼ºé‡è¯•å’Œé”™è¯¯å¤„ç†"""
    max_retries = self.settings.FIRECRAWL_MAX_RETRIES
    retry_delays = [1, 2, 5]  # æŒ‡æ•°é€€é¿

    for attempt in range(max_retries):
        try:
            # æ£€æŸ¥ç½‘ç»œè¿æ¥
            if not await self._check_connectivity():
                logger.warning(f"âš ï¸ ç½‘ç»œè¿æ¥æ£€æŸ¥å¤±è´¥,è·³è¿‡æœç´¢ (å°è¯• {attempt+1}/{max_retries})")
                await asyncio.sleep(retry_delays[min(attempt, len(retry_delays)-1)])
                continue

            # æ‰§è¡Œæœç´¢
            response = await self._do_search(query, limit, **kwargs)
            return response

        except httpx.ConnectError as e:
            if "nodename nor servname" in str(e):
                logger.error(f"âŒ DNSè§£æå¤±è´¥: {e}")
            else:
                logger.error(f"âŒ ç½‘ç»œè¿æ¥å¤±è´¥: {e}")

            if attempt < max_retries - 1:
                delay = retry_delays[min(attempt, len(retry_delays)-1)]
                logger.info(f"ğŸ”„ {delay}ç§’åé‡è¯•...")
                await asyncio.sleep(delay)
            else:
                logger.error("âŒ å·²è¾¾æœ€å¤§é‡è¯•æ¬¡æ•°,æœç´¢å¤±è´¥")
                return []  # è¿”å›ç©ºç»“æœè€Œä¸æ˜¯æŠ›å‡ºå¼‚å¸¸

    return []

async def _check_connectivity(self) -> bool:
    """æ£€æŸ¥APIè¿é€šæ€§"""
    try:
        async with httpx.AsyncClient(timeout=5) as client:
            response = await client.get(f"{self.settings.FIRECRAWL_BASE_URL}/health")
            return response.status_code == 200
    except Exception:
        return False
```

### 2. æ·»åŠ å¥åº·æ£€æŸ¥ç«¯ç‚¹

`src/api/v1/endpoints/health.py`:
```python
from fastapi import APIRouter, HTTPException

router = APIRouter()

@router.get("/health/firecrawl")
async def check_firecrawl_health():
    """æ£€æŸ¥Firecrawl APIå¥åº·çŠ¶æ€"""
    try:
        async with httpx.AsyncClient(timeout=5) as client:
            response = await client.get("https://api.firecrawl.dev/health")
            return {
                "status": "healthy" if response.status_code == 200 else "unhealthy",
                "response_time_ms": response.elapsed.total_seconds() * 1000
            }
    except Exception as e:
        return {
            "status": "unreachable",
            "error": str(e)
        }
```

---

## ğŸ“ æ€»ç»“

### é—®é¢˜çŠ¶æ€

| æ–¹é¢ | çŠ¶æ€ | è¯´æ˜ |
|------|------|------|
| **ä»»åŠ¡è°ƒåº¦** | âœ… **å·²è§£å†³** | é€šè¿‡æ•°æ®åº“è¿ç§»æ·»åŠ  `is_active` å­—æ®µ |
| **ä»»åŠ¡æ‰§è¡Œ** | âœ… **æ­£å¸¸** | ä»»åŠ¡æŒ‰æ—¶è§¦å‘å’Œå®Œæˆ |
| **æœç´¢åŠŸèƒ½** | âŒ **å½“å‰æ•…éšœ** | Firecrawl APIç½‘ç»œè¿æ¥å¤±è´¥ |
| **æ•°æ®æŒä¹…åŒ–** | âš ï¸ **å—å½±å“** | å› æœç´¢å¤±è´¥æ— ç»“æœå¯ä¿å­˜ |

### ç”¨æˆ·é—®é¢˜æ¾„æ¸…

**ç”¨æˆ·é—®é¢˜**: "search_results æœ¬åœ°æ•°æ®åº“ 237408060762787840 å®šæ—¶ä»»åŠ¡æ²¡æœ‰å¯åŠ¨"

**å®é™…æƒ…å†µ**:
- âœ… ä»»åŠ¡ **å·²ç»å¯åŠ¨** å¹¶ **æˆåŠŸæ‰§è¡Œ**
- âŒ ä½†æœç´¢ **å¤±è´¥äº†**,æ‰€ä»¥ **æ²¡æœ‰ç»“æœ** ä¿å­˜åˆ° `search_results` é›†åˆ
- ğŸ” å¤±è´¥åŸå› æ˜¯ **ç½‘ç»œè¿æ¥é—®é¢˜**,ä¸æ˜¯ä»»åŠ¡è°ƒåº¦é—®é¢˜

### ä¸‹ä¸€æ­¥è¡ŒåŠ¨

1. **ç«‹å³**: éªŒè¯ç½‘ç»œè¿æ¥å’ŒDNSè§£æ
2. **çŸ­æœŸ**: ä¿®å¤ç½‘ç»œé—®é¢˜æˆ–é…ç½®ä»£ç†
3. **ä¸­æœŸ**: å¢å¼ºé”™è¯¯å¤„ç†å’Œé‡è¯•æœºåˆ¶
4. **é•¿æœŸ**: å®ç°ç›‘æ§å‘Šè­¦å’Œé™çº§ç­–ç•¥

---

**æŠ¥å‘Šç”Ÿæˆæ—¶é—´**: 2025-10-17 14:08:00
**ä¸‹æ¬¡ä»»åŠ¡æ‰§è¡Œ**: 2025-10-17 15:00:00
**å»ºè®®**: åœ¨15:00å‰è§£å†³ç½‘ç»œé—®é¢˜,ç¡®ä¿ä¸‹æ¬¡æ‰§è¡Œèƒ½æˆåŠŸè·å–ç»“æœ
