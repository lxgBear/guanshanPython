# æ‰¹é‡ç¼–è¾‘åŠŸèƒ½éœ€æ±‚æ–‡æ¡£

**ç‰ˆæœ¬**: v1.0.0
**æ—¥æœŸ**: 2025-11-17
**éœ€æ±‚ç±»å‹**: ç®€åŒ–ç‰ˆ - ä»…æ‰¹é‡ç¼–è¾‘åŠŸèƒ½

---

## ä¸€ã€éœ€æ±‚æ¦‚è¿°

### 1.1 æ ¸å¿ƒéœ€æ±‚

ç”¨æˆ·éœ€è¦èƒ½å¤Ÿ**æ‰¹é‡ç¼–è¾‘**AIæœåŠ¡è¿”å›çš„æœç´¢ç»“æœæ•°æ®ï¼Œæ”¯æŒï¼š
- âœ… æ‰¹é‡ç¼–è¾‘å¤šæ¡è®°å½•ï¼ˆç›¸åŒå­—æ®µï¼‰
- âœ… æ‰¹é‡ç¼–è¾‘å¤šæ¡è®°å½•ï¼ˆæ¯æ¡ä¸åŒå­—æ®µï¼‰
- âœ… å•æ¡è®°å½•ç¼–è¾‘

### 1.2 è¡¨ç»“æ„

**è¡¨å**: `user_edited_results`ï¼ˆç”¨æˆ·ç¼–è¾‘ç»“æœè¡¨ï¼‰
**å­—æ®µ**: ä¸ `processed_results` (news_results) å®Œå…¨ç›¸åŒ + é¢å¤–ç¼–è¾‘è¿½è¸ªå­—æ®µ

---

## äºŒã€æ•°æ®åº“è®¾è®¡

### 2.1 è¡¨ç»“æ„

**åŸºç¡€å­—æ®µ**: å¤ç”¨ `ProcessedResult` å®ä½“çš„æ‰€æœ‰43+å­—æ®µ

**é¢å¤–ç¼–è¾‘è¿½è¸ªå­—æ®µ**:
```python
editor_id: Optional[str]           # æœ€åç¼–è¾‘äººID
edited_at: Optional[datetime]      # æœ€åç¼–è¾‘æ—¶é—´
source_result_id: Optional[str]    # æ¥æºè®°å½•IDï¼ˆå¦‚æœä»åŸè¡¨å¤åˆ¶ï¼‰
edit_count: int = 0                # ç¼–è¾‘æ¬¡æ•°
```

### 2.2 å¯ç¼–è¾‘å­—æ®µæ¸…å•

#### **æ ¸å¿ƒå†…å®¹å­—æ®µ** (6ä¸ª)
```python
title                    # æ ‡é¢˜
content_zh               # ä¸­æ–‡ç¿»è¯‘å†…å®¹
title_generated          # AIç”Ÿæˆçš„æ ‡é¢˜
news_results.title       # æœ€ç»ˆæ ‡é¢˜
news_results.content     # æœ€ç»ˆå†…å®¹
news_results.category    # åˆ†ç±»ä¿¡æ¯ï¼ˆå¤§ç±»/ç±»åˆ«/åœ°åŸŸï¼‰
```

#### **æ ‡ç­¾ä¸åˆ†ç±»** (2ä¸ª)
```python
article_tag              # æ–‡ç« æ ‡ç­¾åˆ—è¡¨
cls_results              # åˆ†ç±»ç»“æœ
```

#### **å…ƒæ•°æ®å­—æ®µ** (5ä¸ª)
```python
author                   # ä½œè€…
published_date           # å‘å¸ƒæ—¥æœŸ
news_results.published_at # æœ€ç»ˆå‘å¸ƒæ—¶é—´
news_results.source      # æ¥æºåŸŸå
language                 # è¯­è¨€ä»£ç 
```

#### **è´¨é‡è¯„ä¼°** (2ä¸ª)
```python
user_rating              # ç”¨æˆ·è¯„åˆ† (1-5)
user_notes               # ç”¨æˆ·å¤‡æ³¨
```

#### **åª’ä½“èµ„æº** (1ä¸ª)
```python
news_results.media_urls  # åª’ä½“URLåˆ—è¡¨
```

**æ€»è®¡**: 16ä¸ªå¯ç¼–è¾‘å­—æ®µ

#### **ä¸å¯ç¼–è¾‘å­—æ®µ**
```python
âŒ id, raw_result_id, task_id        # ä¸»é”®å’Œå…³è”ID
âŒ url                                # åŸå§‹URL
âŒ content, html_content              # åŸå§‹å†…å®¹ï¼ˆåªè¯»ï¼‰
âŒ markdown_content                   # åŸå§‹Markdown
âŒ ai_model, ai_processing_time_ms   # AIå…ƒæ•°æ®
âŒ processing_status                  # å¤„ç†çŠ¶æ€
âŒ created_at                         # åˆ›å»ºæ—¶é—´
```

### 2.3 MongoDBç´¢å¼•

```python
# 1. ç¼–è¾‘äººæŸ¥è¯¢ç´¢å¼•
{"editor_id": 1, "edited_at": -1}

# 2. æ¥æºå…³è”ç´¢å¼•
{"source_result_id": 1}

# 3. ä»»åŠ¡æŸ¥è¯¢ç´¢å¼•
{"task_id": 1, "edited_at": -1}

# 4. åˆ›å»ºæ—¶é—´ç´¢å¼•
{"created_at": -1}

# 5. å…¨æ–‡æœç´¢ç´¢å¼•
{"title": "text", "content_zh": "text"}
```

---

## ä¸‰ã€APIè®¾è®¡

### 3.1 APIç«¯ç‚¹æ¦‚è§ˆ

| ç«¯ç‚¹ | æ–¹æ³• | è¯´æ˜ | åœºæ™¯ |
|------|------|------|------|
| `/user-edits/batch` | POST | æ‰¹é‡æ›´æ–°ï¼ˆçµæ´»ï¼‰ | æ¯æ¡è®°å½•ç¼–è¾‘ä¸åŒå­—æ®µ |
| `/user-edits/batch-fields` | POST | æ‰¹é‡æ›´æ–°ï¼ˆç»Ÿä¸€ï¼‰ | å¤šæ¡è®°å½•è®¾ç½®ç›¸åŒå€¼ |
| `/user-edits/{id}` | PATCH | å•æ¡æ›´æ–° | ç¼–è¾‘å•æ¡è®°å½• |
| `/user-edits/{id}` | GET | è·å–è¯¦æƒ… | æŸ¥çœ‹ç¼–è¾‘è®°å½• |
| `/user-edits/copy` | POST | ä»åŸè¡¨å¤åˆ¶ | å¤åˆ¶è®°å½•ç”¨äºç¼–è¾‘ |

### 3.2 æ‰¹é‡æ›´æ–°ï¼ˆçµæ´»æ¨¡å¼ï¼‰

**ç«¯ç‚¹**: `POST /api/v1/user-edits/batch`

**ç”¨é€”**: ä¸€æ¬¡æ›´æ–°å¤šæ¡è®°å½•ï¼Œæ¯æ¡å¯ä»¥æ›´æ–°ä¸åŒå­—æ®µ

**è¯·æ±‚ä½“**:
```json
{
  "updates": [
    {
      "id": "record_id_1",
      "title": "ä¿®æ­£åçš„æ ‡é¢˜1",
      "content_zh": "ä¿®æ­£åçš„å†…å®¹1",
      "news_results": {
        "category": {
          "å¤§ç±»": "ç§‘æŠ€",
          "ç±»åˆ«": "äººå·¥æ™ºèƒ½",
          "åœ°åŸŸ": "ç¾å›½"
        }
      }
    },
    {
      "id": "record_id_2",
      "title": "ä¿®æ­£åçš„æ ‡é¢˜2",
      "article_tag": ["GPT-5", "AI"]
    },
    {
      "id": "record_id_3",
      "user_rating": 5,
      "user_notes": "ä¼˜è´¨å†…å®¹"
    }
  ],
  "editor_id": "user_123"
}
```

**å“åº”**:
```json
{
  "success": true,
  "total": 3,
  "updated": 3,
  "failed": 0,
  "results": [
    {
      "id": "record_id_1",
      "success": true,
      "updated_fields": ["title", "content_zh", "news_results"]
    },
    {
      "id": "record_id_2",
      "success": true,
      "updated_fields": ["title", "article_tag"]
    },
    {
      "id": "record_id_3",
      "success": true,
      "updated_fields": ["user_rating", "user_notes"]
    }
  ]
}
```

**å‰ç«¯åœºæ™¯**:
```
ç”¨æˆ·æ“ä½œï¼š
1. å‹¾é€‰3æ¡è®°å½•
2. è¿›å…¥æ‰¹é‡ç¼–è¾‘æ¨¡å¼ï¼ˆç±»ä¼¼Excelè¡¨æ ¼ï¼‰
3. ä¸ºæ¯æ¡è®°å½•å•ç‹¬ä¿®æ”¹ä¸åŒå­—æ®µ
4. ç‚¹å‡»"æ‰¹é‡ä¿å­˜"
```

### 3.3 æ‰¹é‡æ›´æ–°ï¼ˆç»Ÿä¸€å­—æ®µæ¨¡å¼ï¼‰

**ç«¯ç‚¹**: `POST /api/v1/user-edits/batch-fields`

**ç”¨é€”**: ä¸€æ¬¡æ›´æ–°å¤šæ¡è®°å½•çš„**ç›¸åŒå­—æ®µ**ä¸º**ç›¸åŒå€¼**

**è¯·æ±‚ä½“**:
```json
{
  "record_ids": [
    "record_id_1",
    "record_id_2",
    "record_id_3",
    "record_id_4",
    "record_id_5"
  ],
  "updates": {
    "news_results": {
      "category": {
        "å¤§ç±»": "ç§‘æŠ€",
        "ç±»åˆ«": "äººå·¥æ™ºèƒ½",
        "åœ°åŸŸ": "ç¾å›½"
      }
    },
    "article_tag": ["GPT-5", "AI", "æŠ€æœ¯"],
    "user_rating": 4
  },
  "editor_id": "user_123"
}
```

**å“åº”**:
```json
{
  "success": true,
  "total": 5,
  "updated": 5,
  "failed": 0,
  "updated_fields": ["news_results", "article_tag", "user_rating"],
  "message": "æˆåŠŸæ›´æ–°5æ¡è®°å½•"
}
```

**å‰ç«¯åœºæ™¯**:
```
ç”¨æˆ·æ“ä½œï¼š
1. å‹¾é€‰5æ¡è®°å½•
2. ç‚¹å‡»"æ‰¹é‡è®¾ç½®åˆ†ç±»"
3. åœ¨å¼¹çª—ä¸­é€‰æ‹©ï¼šç§‘æŠ€ > äººå·¥æ™ºèƒ½ > ç¾å›½
4. æ·»åŠ æ ‡ç­¾ï¼šGPT-5, AI, æŠ€æœ¯
5. è®¾ç½®è¯„åˆ†ï¼š4æ˜Ÿ
6. ç‚¹å‡»"åº”ç”¨åˆ°æ‰€é€‰è®°å½•"
```

### 3.4 å•æ¡æ›´æ–°

**ç«¯ç‚¹**: `PATCH /api/v1/user-edits/{id}`

**ç”¨é€”**: æ›´æ–°å•æ¡è®°å½•çš„å¤šä¸ªå­—æ®µ

**è¯·æ±‚ä½“**:
```json
{
  "title": "ä¿®æ­£åçš„æ ‡é¢˜",
  "content_zh": "ä¿®æ­£åçš„ä¸­æ–‡å†…å®¹",
  "news_results": {
    "title": "ç²¾ç‚¼çš„æœ€ç»ˆæ ‡é¢˜",
    "content": "ç²¾ç‚¼çš„æœ€ç»ˆå†…å®¹",
    "category": {
      "å¤§ç±»": "æ–°é—»",
      "ç±»åˆ«": "å›½é™…",
      "åœ°åŸŸ": "æ¬§æ´²"
    },
    "source": "example.com",
    "published_at": "2025-11-17T10:00:00Z"
  },
  "article_tag": ["æ–°é—»", "å›½é™…", "æ¬§æ´²"],
  "author": "å¼ ä¸‰",
  "user_rating": 5,
  "user_notes": "å†…å®¹ç¿»è¯‘å‡†ç¡®ï¼Œåˆ†ç±»æ­£ç¡®",
  "editor_id": "user_123"
}
```

**å“åº”**:
```json
{
  "success": true,
  "id": "record_id_1",
  "updated_fields": [
    "title",
    "content_zh",
    "news_results",
    "article_tag",
    "author",
    "user_rating",
    "user_notes"
  ],
  "edited_at": "2025-11-17T10:30:00Z",
  "edit_count": 3
}
```

**å‰ç«¯åœºæ™¯**:
```
ç”¨æˆ·æ“ä½œï¼š
1. ç‚¹å‡»æŸæ¡è®°å½•çš„"ç¼–è¾‘"æŒ‰é’®
2. è¿›å…¥ç¼–è¾‘è¡¨å•é¡µé¢
3. ä¿®æ”¹æ ‡é¢˜ã€å†…å®¹ã€åˆ†ç±»ã€æ ‡ç­¾ç­‰å¤šä¸ªå­—æ®µ
4. ç‚¹å‡»"ä¿å­˜"
```

### 3.5 è·å–è®°å½•è¯¦æƒ…

**ç«¯ç‚¹**: `GET /api/v1/user-edits/{id}`

**å“åº”**:
```json
{
  "id": "record_id_1",
  "title": "è®°å½•æ ‡é¢˜",
  "content_zh": "ä¸­æ–‡å†…å®¹",
  "news_results": {...},
  "article_tag": [...],
  "editor_id": "user_123",
  "edited_at": "2025-11-17T10:30:00Z",
  "edit_count": 3,
  "source_result_id": "original_id_456",
  "created_at": "2025-11-17T09:00:00Z",
  "updated_at": "2025-11-17T10:30:00Z"
}
```

### 3.6 ä»åŸè¡¨å¤åˆ¶

**ç«¯ç‚¹**: `POST /api/v1/user-edits/copy`

**ç”¨é€”**: ä» `processed_results` è¡¨å¤åˆ¶è®°å½•åˆ° `user_edited_results` ç”¨äºç¼–è¾‘

**è¯·æ±‚ä½“**:
```json
{
  "source_ids": [
    "original_id_1",
    "original_id_2",
    "original_id_3"
  ],
  "editor_id": "user_123"
}
```

**å“åº”**:
```json
{
  "success": true,
  "total": 3,
  "copied": 3,
  "failed": 0,
  "new_ids": [
    "new_id_1",
    "new_id_2",
    "new_id_3"
  ]
}
```

---

## å››ã€å‰ç«¯äº¤äº’æµç¨‹

### 4.1 æ‰¹é‡ç¼–è¾‘æµç¨‹ï¼ˆç»Ÿä¸€å­—æ®µï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. ç”¨æˆ·åœ¨åˆ—è¡¨ä¸­å‹¾é€‰10æ¡è®°å½•              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. ç‚¹å‡»"æ‰¹é‡ç¼–è¾‘"æŒ‰é’®                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. å¼¹å‡ºç¼–è¾‘è¡¨å•                          â”‚
â”‚    - åˆ†ç±»é€‰æ‹©ï¼šç§‘æŠ€ > AI > ç¾å›½          â”‚
â”‚    - æ ‡ç­¾è¾“å…¥ï¼šGPT-5, æŠ€æœ¯çªç ´           â”‚
â”‚    - è¯„åˆ†ï¼š5æ˜Ÿ                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. ç‚¹å‡»"åº”ç”¨åˆ°æ‰€é€‰è®°å½•"                  â”‚
â”‚    â†’ POST /user-edits/batch-fields       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 5. æ˜¾ç¤ºæˆåŠŸæç¤ºï¼š"å·²æ›´æ–°10æ¡è®°å½•"        â”‚
â”‚    â†’ åˆ—è¡¨åˆ·æ–°ï¼Œæ˜¾ç¤ºæ›´æ–°åçš„æ•°æ®          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.2 æ‰¹é‡ç¼–è¾‘æµç¨‹ï¼ˆé€æ¡ä¸åŒï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. ç”¨æˆ·å‹¾é€‰5æ¡è®°å½•                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. ç‚¹å‡»"æ‰¹é‡ç¼–è¾‘ï¼ˆè¯¦ç»†ï¼‰"                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. è¿›å…¥æ‰¹é‡ç¼–è¾‘é¡µé¢ï¼ˆç±»ä¼¼Excelï¼‰         â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚    â”‚ æ ‡é¢˜   â”‚ å†…å®¹   â”‚ åˆ†ç±»   â”‚         â”‚
â”‚    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¤         â”‚
â”‚    â”‚ [å¯ç¼–è¾‘] â”‚ [å¯ç¼–è¾‘] â”‚ [å¯ç¼–è¾‘] â”‚     â”‚
â”‚    â”‚ [å¯ç¼–è¾‘] â”‚ [å¯ç¼–è¾‘] â”‚ [å¯ç¼–è¾‘] â”‚     â”‚
â”‚    â”‚ [å¯ç¼–è¾‘] â”‚ [å¯ç¼–è¾‘] â”‚ [å¯ç¼–è¾‘] â”‚     â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. ç”¨æˆ·ä¸ºæ¯æ¡è®°å½•å•ç‹¬ç¼–è¾‘                â”‚
â”‚    - è®°å½•1ï¼šä¿®æ”¹æ ‡é¢˜å’Œå†…å®¹               â”‚
â”‚    - è®°å½•2ï¼šåªä¿®æ”¹åˆ†ç±»                   â”‚
â”‚    - è®°å½•3ï¼šä¿®æ”¹æ ‡é¢˜ã€åˆ†ç±»ã€æ ‡ç­¾         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 5. ç‚¹å‡»"æ‰¹é‡ä¿å­˜"                        â”‚
â”‚    â†’ POST /user-edits/batch              â”‚
â”‚    Body: [                               â”‚
â”‚      {id: "1", title: "...", content: "..."},â”‚
â”‚      {id: "2", category: {...}},         â”‚
â”‚      {id: "3", title: "...", tags: [...]}â”‚
â”‚    ]                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 6. æ˜¾ç¤ºæˆåŠŸæç¤ºï¼š"å·²ä¿å­˜5æ¡è®°å½•"         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.3 å•æ¡ç¼–è¾‘æµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. ç‚¹å‡»æŸæ¡è®°å½•çš„"ç¼–è¾‘"æŒ‰é’®              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. è¿›å…¥ç¼–è¾‘è¡¨å•é¡µé¢                      â”‚
â”‚    â†’ GET /user-edits/{id} è·å–å½“å‰å€¼     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. æ˜¾ç¤ºè¡¨å•ï¼Œé¢„å¡«å½“å‰å€¼                  â”‚
â”‚    - æ ‡é¢˜: [å½“å‰æ ‡é¢˜]                    â”‚
â”‚    - å†…å®¹: [å½“å‰å†…å®¹]                    â”‚
â”‚    - åˆ†ç±»: [å½“å‰åˆ†ç±»]                    â”‚
â”‚    - æ ‡ç­¾: [å½“å‰æ ‡ç­¾]                    â”‚
â”‚    - è¯„åˆ†: â­â­â­â­â­                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. ç”¨æˆ·ä¿®æ”¹å¤šä¸ªå­—æ®µ                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 5. ç‚¹å‡»"ä¿å­˜"                            â”‚
â”‚    â†’ PATCH /user-edits/{id}              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 6. æ˜¾ç¤ºæˆåŠŸæç¤ºï¼Œè¿”å›åˆ—è¡¨                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## äº”ã€æ•°æ®éªŒè¯è§„åˆ™

### 5.1 å­—æ®µéªŒè¯

```python
# åˆ†ç±»éªŒè¯
news_results.category: {
    "å¤§ç±»": å¿…å¡«, å­—ç¬¦ä¸²,
    "ç±»åˆ«": å¿…å¡«, å­—ç¬¦ä¸²,
    "åœ°åŸŸ": å¿…å¡«, å­—ç¬¦ä¸²
}

# è¯„åˆ†éªŒè¯
user_rating: å¯é€‰, æ•´æ•°, èŒƒå›´ 1-5

# æ ‡ç­¾éªŒè¯
article_tag: å¯é€‰, å­—ç¬¦ä¸²æ•°ç»„, æœ€å¤š20ä¸ªæ ‡ç­¾

# æ—¥æœŸéªŒè¯
published_date: å¯é€‰, ISO 8601æ ¼å¼
news_results.published_at: å¯é€‰, ISO 8601æ ¼å¼

# è¯­è¨€éªŒè¯
language: å¯é€‰, æœ‰æ•ˆè¯­è¨€ä»£ç ï¼ˆzh, en, ja, etc.ï¼‰

# URLéªŒè¯
news_results.media_urls: å¯é€‰, URLæ•°ç»„, æ ¼å¼éªŒè¯
```

### 5.2 æ‰¹é‡æ“ä½œé™åˆ¶

```python
# æ‰¹é‡æ›´æ–°æ•°é‡é™åˆ¶
batch_update_limit: 100æ¡/æ¬¡

# å•æ¬¡è¯·æ±‚å¤§å°é™åˆ¶
max_request_size: 10MB

# å¹¶å‘ç¼–è¾‘å†²çªæ£€æµ‹
# ä½¿ç”¨ updated_at æ—¶é—´æˆ³æ£€æµ‹å¹¶å‘ä¿®æ”¹
```

---

## å…­ã€é”™è¯¯å¤„ç†

### 6.1 é”™è¯¯å“åº”æ ¼å¼

```json
{
  "success": false,
  "error": {
    "code": "VALIDATION_ERROR",
    "message": "å­—æ®µéªŒè¯å¤±è´¥",
    "details": [
      {
        "field": "news_results.category.å¤§ç±»",
        "error": "ä¸èƒ½ä¸ºç©º"
      },
      {
        "field": "user_rating",
        "error": "å¿…é¡»åœ¨1-5ä¹‹é—´"
      }
    ]
  }
}
```

### 6.2 æ‰¹é‡æ“ä½œéƒ¨åˆ†å¤±è´¥

```json
{
  "success": false,
  "total": 5,
  "updated": 3,
  "failed": 2,
  "results": [
    {
      "id": "record_1",
      "success": true
    },
    {
      "id": "record_2",
      "success": true
    },
    {
      "id": "record_3",
      "success": true
    },
    {
      "id": "record_4",
      "success": false,
      "error": "è®°å½•ä¸å­˜åœ¨"
    },
    {
      "id": "record_5",
      "success": false,
      "error": "åˆ†ç±»æ ¼å¼é”™è¯¯"
    }
  ]
}
```

---

## ä¸ƒã€å®æ–½è®¡åˆ’

### 7.1 å¼€å‘é˜¶æ®µï¼ˆ3-5å¤©ï¼‰

**é˜¶æ®µ1: Repositoryå±‚ (1å¤©)**
- [ ] åˆ›å»º `UserEditRepository`
- [ ] å®ç°æ‰¹é‡æ›´æ–°æ–¹æ³•
- [ ] å®ç°å•æ¡æ›´æ–°æ–¹æ³•
- [ ] å•å…ƒæµ‹è¯•

**é˜¶æ®µ2: Serviceå±‚ (1å¤©)**
- [ ] åˆ›å»º `UserEditService`
- [ ] å®ç°å­—æ®µéªŒè¯é€»è¾‘
- [ ] å®ç°æ‰¹é‡æ“ä½œäº‹åŠ¡å¤„ç†
- [ ] å•å…ƒæµ‹è¯•

**é˜¶æ®µ3: APIå±‚ (1-2å¤©)**
- [ ] åˆ›å»º `user_edits.py` Router
- [ ] å®ç°3ä¸ªæ ¸å¿ƒç«¯ç‚¹
- [ ] APIé›†æˆæµ‹è¯•
- [ ] Swaggeræ–‡æ¡£

**é˜¶æ®µ4: æ•°æ®åº“è„šæœ¬ (0.5å¤©)**
- [ ] åˆ›å»ºç´¢å¼•è„šæœ¬
- [ ] åˆ›å»ºæµ‹è¯•æ•°æ®è„šæœ¬

**é˜¶æ®µ5: é›†æˆæµ‹è¯• (0.5å¤©)**
- [ ] ç«¯åˆ°ç«¯æµ‹è¯•
- [ ] æ€§èƒ½æµ‹è¯•

### 7.2 æ–‡ä»¶æ¸…å•

#### **æ–°å¢æ–‡ä»¶** (5ä¸ª)
```
src/infrastructure/database/user_edit_repository.py
src/services/user_edit_service.py
src/api/v1/endpoints/user_edits.py
scripts/create_user_edits_indexes.py
scripts/test_batch_edit.py
```

#### **ä¿®æ”¹æ–‡ä»¶** (1ä¸ª)
```
src/api/v1/router.py  # æ³¨å†Œæ–°Router
```

---

## å…«ã€ä½¿ç”¨ç¤ºä¾‹

### 8.1 å‰ç«¯ä»£ç ç¤ºä¾‹ï¼ˆReact + TypeScriptï¼‰

```typescript
// æ‰¹é‡ç¼–è¾‘ï¼ˆç»Ÿä¸€å­—æ®µï¼‰
const handleBatchEditFields = async (selectedIds: string[]) => {
  const response = await fetch('/api/v1/user-edits/batch-fields', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({
      record_ids: selectedIds,
      updates: {
        news_results: {
          category: {
            å¤§ç±»: 'ç§‘æŠ€',
            ç±»åˆ«: 'äººå·¥æ™ºèƒ½',
            åœ°åŸŸ: 'ç¾å›½'
          }
        },
        article_tag: ['GPT-5', 'AI'],
        user_rating: 5
      },
      editor_id: currentUser.id
    })
  });

  const result = await response.json();
  if (result.success) {
    message.success(`æˆåŠŸæ›´æ–°${result.updated}æ¡è®°å½•`);
    refreshList();
  }
};

// æ‰¹é‡ç¼–è¾‘ï¼ˆé€æ¡ä¸åŒï¼‰
const handleBatchEdit = async (updates: Array<{id: string, fields: any}>) => {
  const response = await fetch('/api/v1/user-edits/batch', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({
      updates: updates.map(item => ({
        id: item.id,
        ...item.fields
      })),
      editor_id: currentUser.id
    })
  });

  const result = await response.json();
  if (result.success) {
    message.success(`æˆåŠŸä¿å­˜${result.updated}æ¡è®°å½•`);
  }
};

// å•æ¡ç¼–è¾‘
const handleSingleEdit = async (id: string, updates: any) => {
  const response = await fetch(`/api/v1/user-edits/${id}`, {
    method: 'PATCH',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({
      ...updates,
      editor_id: currentUser.id
    })
  });

  const result = await response.json();
  if (result.success) {
    message.success('ä¿å­˜æˆåŠŸ');
    navigate('/list');
  }
};
```

---

## ä¹ã€ä¸ä¹‹å‰æ–¹æ¡ˆçš„å¯¹æ¯”

| ç‰¹æ€§ | ä¹‹å‰æ–¹æ¡ˆï¼ˆå¤æ‚ç‰ˆï¼‰ | å½“å‰æ–¹æ¡ˆï¼ˆç®€åŒ–ç‰ˆï¼‰ |
|------|-------------------|-------------------|
| **è¡¨æ•°é‡** | 1ä¸ªæ–°è¡¨ | 1ä¸ªæ–°è¡¨ |
| **APIç«¯ç‚¹** | 11ä¸ª | 3ä¸ªæ ¸å¿ƒç«¯ç‚¹ |
| **çŠ¶æ€ç®¡ç†** | 5ç§çŠ¶æ€ï¼ˆdraft/submitted/approved/rejected/publishedï¼‰ | æ— çŠ¶æ€ç®¡ç† |
| **å®¡æ ¸æµç¨‹** | å®Œæ•´å®¡æ ¸æµç¨‹ | âŒ æ— å®¡æ ¸ |
| **ç‰ˆæœ¬æ§åˆ¶** | å®Œæ•´ç‰ˆæœ¬å†å² | ç®€å•ç¼–è¾‘è¿½è¸ª |
| **ç¼–è¾‘å†å²** | è¯¦ç»†å˜æ›´è®°å½• | ç¼–è¾‘æ¬¡æ•°+æ—¶é—´ |
| **å¤æ‚åº¦** | é«˜ | ä½ |
| **å¼€å‘æ—¶é—´** | 10-13å¤© | 3-5å¤© |
| **é€‚ç”¨åœºæ™¯** | éœ€è¦å®¡æ ¸çš„æ­£å¼å‘å¸ƒæµç¨‹ | å¿«é€Ÿæ‰¹é‡ç¼–è¾‘æµ‹è¯•æ•°æ® |

---

## åã€æ€»ç»“

### ä¼˜åŠ¿ âœ…
- **ç®€å•é«˜æ•ˆ**: åªå…³æ³¨æ‰¹é‡ç¼–è¾‘æ ¸å¿ƒåŠŸèƒ½
- **çµæ´»å¤šæ ·**: æ”¯æŒ3ç§ç¼–è¾‘æ¨¡å¼ï¼ˆæ‰¹é‡ç»Ÿä¸€/æ‰¹é‡çµæ´»/å•æ¡ï¼‰
- **å¿«é€Ÿå®æ–½**: 3-5å¤©å³å¯å®Œæˆå¼€å‘
- **æ˜“äºç»´æŠ¤**: æ¶æ„ç®€å•ï¼Œä»£ç é‡å°‘

### é™åˆ¶ âš ï¸
- æ— å®¡æ ¸æµç¨‹ï¼ˆå¦‚éœ€å®¡æ ¸ï¼Œéœ€æ‰©å±•ï¼‰
- æ— è¯¦ç»†ç‰ˆæœ¬å†å²ï¼ˆåªè®°å½•æœ€åç¼–è¾‘ï¼‰
- æ— çŠ¶æ€ç®¡ç†ï¼ˆé€‚åˆæµ‹è¯•åœºæ™¯ï¼‰

### æœªæ¥æ‰©å±• ğŸš€
å¦‚éœ€æ›´å®Œå–„çš„åŠŸèƒ½ï¼Œå¯åœ¨æ­¤åŸºç¡€ä¸Šæ‰©å±•ï¼š
- æ·»åŠ å®¡æ ¸æµç¨‹
- æ·»åŠ è¯¦ç»†ç¼–è¾‘å†å²
- æ·»åŠ æƒé™æ§åˆ¶
- æ·»åŠ æ“ä½œæ—¥å¿—

---

**æ–‡æ¡£ç»´æŠ¤**: Backend Team
**æœ€åæ›´æ–°**: 2025-11-17
