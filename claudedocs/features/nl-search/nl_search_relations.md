# ğŸ§  è‡ªç„¶è¯­è¨€æœç´¢ç³»ç»Ÿ ER å…³ç³»å›¾

æœ¬æ–‡ä»¶æè¿°è‡ªç„¶è¯­è¨€æœç´¢ç³»ç»Ÿä¸­ä¸»è¦ä¸‰å¼ è¡¨çš„å…³ç³»ç»“æ„ã€‚

---

## ğŸ—‚ æ•°æ®è¡¨ç»“æ„æ¦‚è§ˆ

### 1ï¸âƒ£ `nl_search_logs` â€” è‡ªç„¶è¯­è¨€æœç´¢è®°å½•è¡¨
å­˜å‚¨æ¯æ¬¡ç”¨æˆ·å‘èµ·çš„è‡ªç„¶è¯­è¨€æŸ¥è¯¢ã€‚

| å­—æ®µå | ç±»å‹ | æè¿° |
|--------|------|------|
| id | BIGINT | ä¸»é”®ï¼Œè‡ªå¢ |
| user_id | BIGINT | ç”¨æˆ·ID |
| query_text | TEXT | åŸå§‹è‡ªç„¶è¯­è¨€æœç´¢å†…å®¹ |
| parsed_query | JSON | è§£æåçš„ç»“æ„åŒ–æŸ¥è¯¢æˆ–å…³é”®è¯ |
| result_count | INT | è¿”å›ç»“æœæ•°é‡ |
| created_at | DATETIME | åˆ›å»ºæ—¶é—´ |

---

### 2ï¸âƒ£ `search_results` â€” ä¸´æ—¶ç»Ÿä¸€ç»“æœä¸»è¡¨
å­˜å‚¨ç³»ç»Ÿæ£€ç´¢çš„æ‰€æœ‰ç»“æœï¼ˆæ¥æºå¤šæ ·ï¼Œå¯è¢«æ¸…ç†ï¼‰ã€‚

| å­—æ®µå | ç±»å‹ | æè¿° |
|--------|------|------|
| id | BIGINT | ä¸»é”®ï¼Œè‡ªå¢ |
| source | VARCHAR(255) | æ•°æ®æ¥æºæ ‡è¯† |
| title | VARCHAR(255) | æ ‡é¢˜ |
| summary | TEXT | ç®€è¦è¯´æ˜ |
| content | TEXT | åŸæ–‡æˆ–æè¦å†…å®¹ |
| score | FLOAT | åŒ¹é…åˆ†æ•° |
| metadata | JSON | é™„åŠ ä¿¡æ¯ï¼ˆåˆ†ç±»ã€æ—¶é—´ç­‰ï¼‰ |
| created_at | DATETIME | åˆ›å»ºæ—¶é—´ |

> âš ï¸ æ­¤è¡¨ä¸­æ•°æ®å¯èƒ½è¢«æ¸…ç†ï¼Œç”¨æˆ·è¡Œä¸ºæ•°æ®éœ€è¦åœ¨ `nl_user_selections` è¡¨ä¸­å­˜å‚¨å¿«ç…§å‰¯æœ¬ä»¥é¿å…ä¸¢å¤±ã€‚

---

### 3ï¸âƒ£ `nl_user_selections` â€” ç”¨æˆ·é€‰æ‹©ä¸å¿«ç…§è¡¨
è®°å½•ç”¨æˆ·åœ¨æœç´¢ç»“æœä¸­çš„ç‚¹å‡»ã€æ”¶è—ã€åé¦ˆç­‰è¡Œä¸ºï¼Œå¹¶å­˜å‚¨å¿«ç…§ã€‚

| å­—æ®µå | ç±»å‹ | æè¿° |
|--------|------|------|
| id | BIGINT | ä¸»é”®ï¼Œè‡ªå¢ |
| user_id | BIGINT | ç”¨æˆ·ID |
| search_log_id | BIGINT | å¯¹åº”æœç´¢è®°å½•ID |
| result_id | BIGINT | å¯¹åº” search_results çš„ç»“æœID |
| action_type | ENUM | ç”¨æˆ·è¡Œä¸ºç±»å‹ï¼ˆclick, collect, like, share, feedbackï¼‰ |
| snapshot_title | VARCHAR(255) | å¿«ç…§æ ‡é¢˜ |
| snapshot_summary | TEXT | å¿«ç…§æ‘˜è¦ |
| snapshot_content | TEXT | å¿«ç…§æ­£æ–‡å†…å®¹ |
| feedback | TEXT | ç”¨æˆ·åé¦ˆ |
| created_at | DATETIME | è¡Œä¸ºæ—¶é—´ |

---

## ğŸ”— è¡¨å…³ç³»ç»“æ„å›¾

```mermaid
graph TD
  A[nl_search_logs
æœç´¢è®°å½•è¡¨] -->|æ£€ç´¢ç»“æœ| B[search_results
ä¸´æ—¶ç»Ÿä¸€ç»“æœè¡¨]
  A -->|ç”¨æˆ·è¡Œä¸ºåé¦ˆ| C[nl_user_selections
ç”¨æˆ·é€‰æ‹©è¡¨]
  B -->|è¢«å¼•ç”¨å¹¶å­˜å‚¨å¿«ç…§| C
```

---

## ğŸ§© å…³ç³»è¯´æ˜


- **nl_search_logs â†’ search_results**ï¼šç³»ç»Ÿæ ¹æ®æœç´¢è®°å½•ç”Ÿæˆå€™é€‰ç»“æœã€‚
- **nl_search_logs â†’ nl_user_selections**ï¼šç”¨æˆ·åŸºäºæœç´¢è®°å½•è¿›è¡Œäº¤äº’ã€‚
- **search_results â†’ nl_user_selections**ï¼šä¿å­˜ç”¨æˆ·é€‰æ‹©æ—¶ï¼Œå°†ç›¸å…³å†…å®¹å¿«ç…§åŒ–å­˜å‚¨ï¼Œé¿å…åç»­æ•°æ®æ¸…ç†å¯¼è‡´ä¸¢å¤±ã€‚

---

## ğŸ–¼ å¯è§†åŒ–å…³ç³»å›¾

![ERå…³ç³»å›¾](nl_search_relations.png)
